/*
 * Code by Sathish
 * Date 28-08-2024
 */
var previousData = '';
var currentValue = '';
var kendraAttendance = [{
    "kendraId": "32061",
    "groupId": "32189",
    "groupName": "",
    "collectionStatus": "",
    "customers": [{
        "customerId": "4651328",
        "customerName": "B B Ayisha",
        "outstandingAmt": 20000,
        "dueAmount": 1800,
        "parAmount": 0,
        "member": "Eqbal Ahamad Alias Ikbal Ahamed B",
        "attendanceStatus": "",
        "cashCollected": 1800,
        "upiCollected": 0,
        "advanceCollected": 0
    }, {
        "customerId": "33072",
        "customerName": "Fatheema B",
        "outstandingAmt": 12000,
        "dueAmount": 1500,
        "parAmount": 1000,
        "member": "Karim Pasha Alias Mohammed Karim G",
        "attendanceStatus": "",
        "cashCollected": 1500,
        "upiCollected": 0,
        "advanceCollected": 0
    }]
}, {
    "kendraId": "32061",
    "groupId": "32190",
    "groupName": "",
    "collectionStatus": "",
    "customers": [{
        "customerId": "1981325",
        "customerName": "Gulzar Begum A",
        "outstandingAmt": 20000,
        "dueAmount": 900,
        "parAmount": 0,
        "member": "Mohammed Rafiq",
        "attendanceStatus": "",
        "cashCollected": 900,
        "upiCollected": 0,
        "advanceCollected": 0
    }, {
        "customerId": "33075",
        "customerName": "Kala S",
        "outstandingAmt": 5000,
        "dueAmount": 800,
        "parAmount": 0,
        "member": "Prabhu C",
        "attendanceStatus": "",
        "cashCollected": 800,
        "upiCollected": 0,
        "advanceCollected": 0
    }]
}];
var kendraMeetings = [{
    "kendraId": "32061",
    "kendraName": "Nayandahalli petrol banck",
    "startTime": "08:00 AM",
    "customerCount": 20,
    "parCount": 4,
    "outstandingAmt": 20000
}, {
    "kendraId": "189662",
    "kendraName": "ValmikiNagar 2nd Main 4thCross",
    "startTime": "08:45 AM",
    "customerCount": 20,
    "parCount": 4,
    "outstandingAmt": 10000
}, {
    "kendraId": "188590",
    "kendraName": "ShamannagardanSchool02",
    "startTime": "09:30 AM",
    "customerCount": 20,
    "parCount": 4,
    "outstandingAmt": 50000
}];
var isDIScreenLaunchReq = false;
var modalDIFlag = false;
var grpDataScrId = "KenMet__GroupsData__";
var isAmtOrQRText = '';
var selectedCustomerDetails = [];
var selCustRowNo = 0;
var inputEnteredAmt = 0;
var calcLoanAmount = 0;
var dueAdvanceAmt = 0;
var segregAmountArr = [];
var isFullCash = false;
var isPartialCollection = false;
var data = [];
var splitAmtArr = [];
var collectedGroupData = {};
var totalAmtToCal = 0;
var resonForPartialPay = '';
var backNavPaintRecData = '';
var zeroCollectionFlow = false;
var keypadClicked = false;
var zeroFlowScrLaunchFlow = false;
var zeroEnteredFeild = [];
window.markCollectionFlow = false;
var QRStatusTimerInterval = "";
var isFromInProgress = false;
var UPIAllowedForBranch = false;
var advModalOpenCount = 0;
var retryUPIArray = [];
var partialCash = false;
var advanceCash = false;
var selectedGrpId = '';
apz.app.onLoad_GroupsData = function(params) {
    if (userRole == 'KM') {
        // apz.app.KendriyaMeetings.loadWidgetData(params);
        // console.log("In Kendriya meetings micro app")
    }
}
apz.app.onShown_GroupsData = function(params) {
    backNavPaintRecData = params;
    selectedGrpId = params.groupId;
    $("#header").addClass("sno");
    $("#footer").addClass("sno");
    apz.stopLoader();
    ApzCOB.setMinMaxLength(
        [{
            'fieldName': 'Amount',
            'fieldId': grpDataScrId + 'inp_enteredAmtVal'
        }])
    apz.app.GroupsData.loadSelectedKendraDetails(params);
    $("#" + kmDashScrId + 'calculatorIcon').removeClass('sno');
    if (parReasonsArr.length === 0) {
        ApzCOB.FetchLov("PARREASONS");
    }
    if (QRTimerSetVal === 0) {
        ApzCOB.FetchLov("QRTIMER");
    }
    if (QRRefreshTimer === 0) {
        ApzCOB.FetchLov("QRREFRESHTIME");
    }
}
apz.app.GroupsData.loadSelectedKendraDetails = function(params) {
    let kendraDetails = params;
    document.getElementById(grpDataScrId + 'txt_groupName').innerText = params.selectedGroupRow;
    document.getElementById(grpDataScrId + "txt_cashToCollect").innerText = ApzCOB.fn_FormatAmount(params.totalDueAmount);
    document.getElementById(grpDataScrId + "txt_headerDueAmt").innerText = "₹" + ApzCOB.fn_FormatAmount(params.totalAmount);
    totalAmtToCal = params.totalDueAmount;
    previousData = JSON.parse(JSON.stringify([...kendraDetails.CustomerDetail]));
    apz.app.GroupsData.loadGroupsData(kendraDetails.CustomerDetail);
}
apz.app.GroupsData.backNavigation = function(params) {
    let selectedGroupData = [];
    selectedGroupData = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
    for (let m = 0; m < selectedGroupData.length; m++) {
        let loansDet = [];
        loansDet = selectedGroupData[m].loans
        if (!selectedGroupData[m].hasOwnProperty('advAmt')) {
            selectedGroupData[m].advAmt = 0;
        }
        if (selectedGroupData[m].hasOwnProperty('totalAdv') && selectedGroupData[m].totalAdv > 0) {
            selectedGroupData[m].advAdj = selectedGroupData[m].totalDue;
        }
        if (!selectedGroupData[m].hasOwnProperty('advAdj')) {
            selectedGroupData[m].advAdj = 0;
        }
        if (selectedGroupData[m].hasOwnProperty('upiCollected') && selectedGroupData[m].upiCollected > 0) {
            selectedGroupData[m].totalUPI = selectedGroupData[m].upiCollected;
        } else {
            selectedGroupData[m].totalUPI = 0;
        }
        for (let n = 0; n < loansDet.length; n++) {
            if (selectedGroupData[m].collAmount > 0 && selectedGroupData[m].collAmount === selectedGroupData[m].totalDue || selectedGroupData[m]
                .totalDue === selectedGroupData[m].totalAdv + selectedGroupData[m].collAmount) {
                if (selectedGroupData[m].upiCollected > 0) {
                    selectedGroupData[m].loans[n].upiAmt = selectedGroupData[m].loans[n].dueAmt;
                } else {
                    selectedGroupData[m].loans[n].cashAmt = selectedGroupData[m].loans[n].dueAmt;
                }
            } else if (selectedGroupData[m].collAmount === 0 && !selectedGroupData[m].hasOwnProperty('isZeroCollection')) {
                selectedGroupData[m].isZeroParFlg = true;
            }
        }
    }
    currentValue = [...selectedGroupData];
    let zeroCollData = [];
    if (deathIntGrpObj[selectedGrpId].length !== 0) {
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet.forEach((d, i) => {
            let obj = {};
            if (!d.isZeroCollAmtMem && deathIntGrpObj[selectedGrpId].includes(i)) {
                obj.customerName = d.customerName;
                obj.id = d.id;
                obj.depname = d.depname;
                obj.paylod = d;
                zeroCollData.push(obj);
            }
        });
    }
    selectedGroupData.forEach((d, i) => {
        if (d.parFlg == "Y" && !d.isZeroCollAmtMem && d.isZeroCollection) {
            let exists = zeroCollData.some(z => z.id === d.id);
            if (!exists) {
                let obj = {};
                obj.customerName = d.customerName;
                obj.id = d.id;
                obj.depname = d.depname;
                obj.paylod = d;
                zeroCollData.push(obj);
            }
        }
    });
    var collResionWithoutSubmit = []
    deathIntGrpObj[selectedGrpId].forEach((d, i) => {
        collResionWithoutSubmit.push(selectedGroupData[d])
    });
    if (zeroCollData.length === 0 || collResionWithoutSubmit.length === 0) {
        if (isMarkCollectionEdition) {
            zeroFlowScrLaunchFlow = false;
            let prevDataArr = [];
            previousData.forEach((d, i) => {
                prevDataArr.push(d.collAmount)
            });
            let currentValueArr = [];
            currentValue.forEach((d, i) => {
                currentValueArr.push(d.collAmount)
            })
        }
    } else {
        zeroFlowScrLaunchFlow = true;
        collResionWithoutSubmit = [...new Map(collResionWithoutSubmit.map(item => [item.id, item])).values()];
        ApzCOB.launchMicroApp("KenMet", "ZeroCollection", grpDataScrId + "zeroCollectionComDiv", collResionWithoutSubmit);
        return;
    }
    if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.hasOwnProperty('GroupsCustomerDet') && apz.data.scrdata.KenMet__IPaintKendMeetings_Res
        .GroupsCustomerDet.length > 0) {
        currentValue = [...selectedGroupData];
        let prevDataArr = [];
        previousData.forEach((d, i) => {
            prevDataArr.push(d.collAmount)
        });
        let currentValueArr = [];
        currentValue.forEach((d, i) => {
            currentValueArr.push(d.collAmount)
        })
        if (apz.app.GroupsData.compareArrays(prevDataArr, currentValueArr)) {
            if (apz.childScr === "GroupsData" && params === "stage1") {
                // ApzCOB.dashboardAppListAPI();
                if (apz.app.GroupsData.compareSpecificFields(currentValue, previousData)) {
                    apz.app.GroupsData.onBackNavYes();
                } else {
                    isMarkCollectionEdition = false;
                    apz.app.KMDashboard.handleBackFunction('fromGroupData');
                }
            }
        } else if (apz.app.GroupsData.compareSpecificFields(currentValue, previousData)) {
            apz.app.GroupsData.onBackNavYes();
        } else {
            ApzCOB.toggleModal(grpDataScrId + 'mdl_backNavModal');
        }
    } else {
        if (apz.childScr === "GroupsData" && params === "stage1") {
            // ApzCOB.dashboardAppListAPI();
            isMarkCollectionEdition = false;
            apz.app.KMDashboard.handleBackFunction('fromGroupData');
        }
    }
}
apz.app.GroupsData.loadGroupsData = function(customers) {
    if (customers.length > 0) {
        document.getElementById(grpDataScrId + 'noRecDiv').classList.add('sno');
        document.getElementById(grpDataScrId + 'groupDataDiv').classList.remove('sno');
        document.getElementById(grpDataScrId + 'collctionSubmit').disabled = false;
        var groupsDetails = [];
        var paintData = [];
        var segregatedGroupDet = [];
        segregatedGroupDet.groupDetails = [];
        var outstandingAmt = 0;
        let totCollecAmt = 0;
        let totUPICollecAmt = 0;
        customers.forEach((obj, i) => {
            outstandingAmt = 0;
            obj.loans.forEach((t, s) => {
                outstandingAmt = outstandingAmt + t.osAmt;
            })
            // obj.kendraId = obj.id;
            // obj.member = obj.depname;
            obj.customerName = obj.name;
            obj.outstandingAmt = ApzCOB.fn_FormatAmount(outstandingAmt);
            // obj.parAmount = obj.parAmt;
            // obj.member = obj.member;
            if (!obj.hasOwnProperty("isZeroCollAmtMem")) {
                if (obj.collAmount === 0) {
                    obj.isZeroCollAmtMem = true;
                } else {
                    obj.isZeroCollAmtMem = false;
                }
            }
            if (obj.hasOwnProperty('cashCollected') && parseInt(String(obj.cashCollected).replace(/,/g, ''), 10) > 0) {
                totCollecAmt = totCollecAmt + parseInt(String(obj.cashCollected).replace(/,/g, ''), 10);
                obj.cashCollected = ApzCOB.fn_FormatAmount(parseInt(String(obj.cashCollected).replace(/,/g, ''), 10));
            } else if (obj.hasOwnProperty('upiCollected') && parseInt(String(obj.upiCollected).replace(/,/g, ''), 10)) {
                totUPICollecAmt = totUPICollecAmt + parseInt(String(obj.upiCollected).replace(/,/g, ''), 10);
                obj.upiCollected = ApzCOB.fn_FormatAmount(parseInt(String(obj.upiCollected).replace(/,/g, ''), 10));
            } else if (obj.hasOwnProperty('totalUPI') && parseInt(String(obj.totalUPI).replace(/,/g, ''), 10)) {
                totUPICollecAmt = totUPICollecAmt + parseInt(String(obj.totalUPI).replace(/,/g, ''), 10);
                obj.upiCollected = ApzCOB.fn_FormatAmount(parseInt(String(obj.totalUPI).replace(/,/g, ''), 10));
            } else {
                if (obj.parFlg === "Y" && obj.collAmount === 0 && !obj.hasOwnProperty('isZeroCollection')) {
                    //  obj.collAmount = obj.netDue; //commented for UNAP-1037
                }
                totCollecAmt = totCollecAmt + obj.collAmount;
                obj.cashCollected = ApzCOB.fn_FormatAmount(obj.collAmount);
            }
            obj.dueAmount = ApzCOB.fn_FormatAmount(obj.totalDue);
            document.getElementById(grpDataScrId + "txt_cashToCollect").innerText = ApzCOB.fn_FormatAmount(totCollecAmt);
            document.getElementById(grpDataScrId + "txt_UPICollection").innerText = ApzCOB.fn_FormatAmount(totUPICollecAmt);
        })
        $('#' + grpDataScrId + 'lst_col_groupMainList_row_0').attr("onclick", "").unbind("click");
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet = [];
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet = customers;
        apz.data.loadData('IPaintKendMeetings', 'KenMet');
        apz.app.GroupsData.showMembersEditData(customers);
    } else {
        document.getElementById(grpDataScrId + 'noRecDiv').classList.remove('sno');
        document.getElementById(grpDataScrId + 'groupDataDiv').classList.add('sno');
        document.getElementById(grpDataScrId + 'collctionSubmit').disabled = true;
    }
}
apz.app.GroupsData.showMembersEditData = function(customers) {
    retryUPIArray = [];
    customers.forEach((obj, i) => {
        if (obj.parFlg === "Y") {
            if (obj.collAmount !== 0 && !obj.hasOwnProperty('isZeroCollection')) {
                document.getElementById(grpDataScrId + 'txt_col_memParFlag_' + i).classList.remove('sno');
                $("#" + grpDataScrId + 'txt_col_memParFlag_' + i).addClass('bg-dark-err');
                document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + i).classList.remove('sno');
            } else {
                document.getElementById(grpDataScrId + 'txt_col_memParFlag_' + i).classList.remove('sno');
                $("#" + grpDataScrId + 'txt_col_memParFlag_' + i).addClass('bg-dark-err');
            }
        } else {
            document.getElementById(grpDataScrId + 'txt_col_memParFlag_' + i).classList.add('sno');
            $("#" + grpDataScrId + 'txt_col_memParFlag_' + i).removeClass('bg-dark-err');
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + i).classList.add('sno');
        }
        if (obj.hasOwnProperty("isCurrentCustPar") && obj.isCurrentCustPar) {
            let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + i);
            mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.remove("sno");
            $("#" + grpDataScrId + "parColTxt_" + i).addClass('bg-dark-err');
        } else {
            let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + i);
            mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.add("sno");
            $("#" + grpDataScrId + "parColTxt_" + i).removeClass('bg-dark-err');
        }
        if (obj.netDue === obj.collAmount) {
            let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + i);
            mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.add("sno");
            $("#" + grpDataScrId + "parColTxt_" + i).removeClass('bg-dark-err');
        }
        if (!apz.app.GroupsData.hideAndShowIButton(selectedKendra.kendraId, obj.id)) {
            document.getElementById(grpDataScrId + 'icn_pendUpdateIcn_' + i).classList.remove('sno');
        } else {
            document.getElementById(grpDataScrId + 'icn_pendUpdateIcn_' + i).classList.add('sno');
        }
        // obj.loans.forEach((loanObj, j) => {
        // })
        if (parseInt(String(obj.outstandingAmt).replace(/,/g, ''), 10) === 0 && parseInt(String(obj.totalDue).replace(/,/g, ''), 10) ===
            0) {
            $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).attr('disabled', true);
            $('#' + grpDataScrId + 'qrScanIcon_' + i).attr('data-disabled', true);
            document.getElementById(grpDataScrId + 'qrScanIcon_' + i).style.opacity = 0.4;
        } else if ((obj.hasOwnProperty('upiCollected') && parseInt(String(obj.upiCollected).replace(/,/g, ''), 10) > 0)) {
            $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).attr('disabled', true);
            $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).val(0);
            // $('#' + grpDataScrId + 'qrScanIcon_' + i).attr('data-disabled', true);
            if (obj.UPIStatus === "INPROGRESS") {
                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).closest('.coll-upiamt').addClass('sno');
                $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + i).closest('.coll-upiamt').removeClass('sno');
            } else if (obj.UPIStatus === "FAILED") {
                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).closest('.coll-upiamt').addClass('sno');
                $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + i).closest('.failedClass').removeClass('sno');
                $("#" + grpDataScrId + "btn_upiRetryBtn_" + i).attr('disabled', false);
                retryUPIArray.push(obj)
            } else if (obj.UPIStatus === "SUCCESS") {
                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).closest('.coll-upiamt').removeClass('sno');
                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).text(obj.upiCollected);
            }
            $('#' + grpDataScrId + 'qrScanIcon_' + i).addClass('sno');
            $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).closest('.scb-col65').addClass('sno');
        } else if ((obj.hasOwnProperty('cashCollected') && parseInt(String(obj.cashCollected).replace(/,/g, ''), 10) > 0)) {
            $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).attr('disabled', false);
            if (obj.loans.length > 0) {
                let CashAmtPresent = (obj.loans).some(loan => loan.cashAmt > 0);
                if (CashAmtPresent) {
                    $('#' + grpDataScrId + 'qrScanIcon_' + i).attr('data-disabled', true);
                    document.getElementById(grpDataScrId + 'qrScanIcon_' + i).style.opacity = 0.4;
                }
            }
            // $('#' + grpDataScrId + 'row_col_paidUPIAmt').addClass('sno');
        }
        //modified below based on UNAP-1545, as customer can have adv amount but 0 due amount
        if (obj.collAmount < obj.totalDue || (obj.totalAdv > 0 && obj.totalDue === 0)) {
            if (obj.parFlg === "Y" || (obj.hasOwnProperty("isCurrentCustPar") && obj.isCurrentCustPar)) {
                if (obj.collAmount === 0 && !obj.hasOwnProperty('isZeroCollection')) {
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).closest('.srb').classList.add('sno');
                } else {
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).closest('.srb').classList.remove('sno');
                    document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + i).classList.remove('sno');
                }
                let paintAmout;
                if (obj.collAmount == 0 && obj.netDue != 0) {
                    paintAmout = 0; //0 added to handle zero colltion display record
                    // obj.collAmount = obj.netDue;//commented for UNAP-1037
                    document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).value = ApzCOB
                        .fn_FormatAmount(obj.collAmount);
                    let zeroCollCostData = apz.app.GroupsData.fetchCustomerListOfDeathIntDraftRec();
                    if (zeroCollCostData.includes(obj.id)) {
                        document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).value = ApzCOB
                            .fn_FormatAmount(paintAmout);
                    }
                } else {
                    paintAmout = obj.collAmount;
                    if (obj.upiCollected > 0) {
                        document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).value = 0;
                        // document.getElementById(grpDataScrId + 'row_col_paidUPIAmt_' + i).classList.remove('sno');
                        document.getElementById(grpDataScrId + 'txt_QRAmtPostAdd_' + i).innerText = "₹" + obj.upiCollected;
                        if (obj.hasOwnProperty('UPIStatus')) {
                            if (obj.UPIStatus === "INPROGRESS") {
                                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).closest('.coll-upiamt').addClass('sno');
                                $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + i).closest('.coll-upiamt').removeClass('sno');
                            } else if (obj.UPIStatus === "FAILED") {
                                $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + i).closest('.coll-upiamt').addClass('sno');
                                $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + i).closest('.failedClass').removeClass('sno');
                            }
                        }
                    } else {
                        document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).value = ApzCOB
                            .fn_FormatAmount(paintAmout);
                        // document.getElementById(grpDataScrId + 'row_col_paidUPIAmt_' + i).classList.add('sno');
                    }
                }
                // document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + i).value = ApzCOB.fn_FormatAmount(paintAmout);
                let parAmt = obj.parAmt > 0 ? obj.parAmt : (obj.netDue - obj.collAmount)
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).innerText = ApzCOB.fn_FormatAmount(parAmt);
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).classList.remove("inf");
                document.getElementById(grpDataScrId + 'txt_afterAmountId_' + i).classList.remove("inf");
                document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + i).classList.remove("inf");
            }
        } else if (obj.advAmt > 0) {
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).closest('.srb').classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_partialAmtText_' + i).classList.add('sno');
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + i).classList.add('sno');
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + i).innerText = 'Advance';
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + i).classList.add("inf");
            document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + i).classList.add("inf");
            document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + i).classList.remove("war");
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + i).classList.remove("war");
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).innerText = obj.advAmt;
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + i).classList.add("inf");
        }
        if (obj.totalAdv > 0) {
            document.getElementById(grpDataScrId + 'txt_custAdvAmt_' + i).closest('.srb').classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_custAdvAmt_' + i).innerText = "₹" + ApzCOB.fn_FormatAmount(obj.totalAdv) +
                " Adv. ";
            document.getElementById(grpDataScrId + 'txt_custNetDueAmt_' + i).innerText = "(Net Due ₹" + ApzCOB.fn_FormatAmount(obj
                .netDue) + ")"
        }
    });
}
apz.app.GroupsData.onClickOfSubmit = function() {
    if ($('body').hasClass('modal-open')) {
        $('body').removeClass('modal-open');
    }
    let selectedGroupData = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
    for (let m = 0; m < selectedGroupData.length; m++) {
        let loansDet = [];
        loansDet = selectedGroupData[m].loans
        // if (!selectedGroupData[m].hasOwnProperty('advAdj')) {
        if (!selectedGroupData[m].hasOwnProperty('advAmt')) {
            selectedGroupData[m].advAmt = 0;
        }
        if (selectedGroupData[m].hasOwnProperty('totalAdv') && selectedGroupData[m].totalAdv > 0) {
            selectedGroupData[m].advAdj = selectedGroupData[m].totalDue;
            // if (selectedGroupData[m].collAmount === 0) {
            //   selectedGroupData[m].collAmount = selectedGroupData[m].totalDue;
            // }
        }
        if (!selectedGroupData[m].hasOwnProperty('advAdj')) {
            selectedGroupData[m].advAdj = 0;
        }
        if (selectedGroupData[m].hasOwnProperty('upiCollected') && selectedGroupData[m].upiCollected > 0) {
            selectedGroupData[m].totalUPI = selectedGroupData[m].upiCollected;
        } else {
            selectedGroupData[m].totalUPI = 0;
        }
        for (let n = 0; n < loansDet.length; n++) {
            if (selectedGroupData[m].collAmount > 0 && selectedGroupData[m].collAmount === selectedGroupData[m].totalDue || selectedGroupData[m]
                .totalDue === selectedGroupData[m].totalAdv + selectedGroupData[m].collAmount) {
                if (selectedGroupData[m].upiCollected > 0) {
                    selectedGroupData[m].loans[n].upiAmt = selectedGroupData[m].loans[n].dueAmt;
                } else {
                    selectedGroupData[m].loans[n].cashAmt = selectedGroupData[m].loans[n].dueAmt;
                }
            } else if (selectedGroupData[m].collAmount === 0 && !selectedGroupData[m].hasOwnProperty('isZeroCollection')) {
                selectedGroupData[m].isZeroParFlg = true;
            }
        }
        // if (selectedGroupData[m].netDue === selectedGroupData[m].collAmount) {
        //     selectedGroupData[m].parFlg = "N"
        // }
    }
    currentValue = [...selectedGroupData];
    let zeroCollData = [];
    // if (zeroEnteredFeild.length !== 0) {
    if (deathIntGrpObj[selectedGrpId].length !== 0) {
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet.forEach((d, i) => {
            let obj = {};
            if (!d.isZeroCollAmtMem && deathIntGrpObj[selectedGrpId].includes(i)) {
                obj.customerName = d.customerName;
                obj.id = d.id;
                obj.depname = d.depname;
                obj.paylod = d;
                zeroCollData.push(obj);
            }
        });
    }
    selectedGroupData.forEach((d, i) => {
        if (d.parFlg == "Y" && !d.isZeroCollAmtMem && d.isZeroCollection) {
            let exists = zeroCollData.some(z => z.id === d.id);
            if (!exists) {
                let obj = {};
                obj.customerName = d.customerName;
                obj.id = d.id;
                obj.depname = d.depname;
                obj.paylod = d;
                zeroCollData.push(obj);
            }
        }
    });
    var collResionWithoutSubmit = []
    deathIntGrpObj[selectedGrpId].forEach((d, i) => {
        collResionWithoutSubmit.push(selectedGroupData[d])
    });
    if (zeroCollData.length === 0 || collResionWithoutSubmit.length === 0) {
        if (isMarkCollectionEdition) {
            zeroFlowScrLaunchFlow = false;
            let prevDataArr = [];
            previousData.forEach((d, i) => {
                prevDataArr.push(d.collAmount)
            });
            let currentValueArr = [];
            currentValue.forEach((d, i) => {
                currentValueArr.push(d.collAmount)
            })
            // Removed as per the provided comments on back navigation, save data, Again user should be allowed
            /*if (apz.app.GroupsData.compareArrays(prevDataArr, currentValueArr)) {
                ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COL_MSG_NOCHANGES"));
                return;
            } else {
                ApzCOB.toogleConformationModel(ApzCOB.getDescfromLitCode("LIT_COL_LBL_WARNINGMSG"), "apz.app.GroupsData.launchSuccessScreen");
            }*/
            ApzCOB.toogleConformationModel(ApzCOB.getDescfromLitCode("LIT_COL_LBL_WARNINGMSG"), "apz.app.GroupsData.launchSuccessScreen");
            $("#KenMet__KMDashboard__calculatorRow").addClass("sno");
            $('#APZCBO__BaseScreens__el_btn_80').attr('onclick', 'apz.app.GroupsData.commonModalHandleCB()');
            $("#APZCBO__BaseScreens__confirmationModel_close").addClass("sno");
        } else {
            ApzCOB.toogleConformationModel(ApzCOB.getDescfromLitCode("LIT_COL_LBL_WARNINGMSG"), "apz.app.GroupsData.launchSuccessScreen");
            $("#KenMet__KMDashboard__calculatorRow").addClass("sno");
            $('#APZCBO__BaseScreens__el_btn_80').attr('onclick', 'apz.app.GroupsData.commonModalHandleCB()');
            $("#APZCBO__BaseScreens__confirmationModel_close").addClass("sno");
        }
    } else {
        zeroFlowScrLaunchFlow = true;
        collResionWithoutSubmit = [...new Map(collResionWithoutSubmit.map(item => [item.id, item])).values()];
        // ApzCOB.launchMicroApp("KenMet", "ZeroCollection", grpDataScrId + "zeroCollectionComDiv", zeroCollData);
        ApzCOB.launchMicroApp("KenMet", "ZeroCollection", grpDataScrId + "zeroCollectionComDiv", collResionWithoutSubmit);
    }
}
apz.app.GroupsData.commonModalHandleCB = function() {
    $("#KenMet__KMDashboard__calculatorRow").removeClass("sno");
    $("#APZCBO__BaseScreens__confirmationModel_close").removeClass("sno")
    $('#APZCBO__BaseScreens__el_btn_80').attr('onclick', "ApzCOB.toggleModal(BaseScrId + 'confirmationModel')")
    ApzCOB.toggleModal(BaseScrId + 'confirmationModel')
}
apz.app.GroupsData.compareArrays = function(arr1, arr2) {
    if (arr1.length !== arr2.length) {
        return false;
    }
    for (let i = 0; i < arr1.length; i++) {
        if (arr1[i] !== arr2[i]) {
            return false;
        }
    }
    return true;
}
apz.app.GroupsData.launchSuccessScreen = function(pthis) {
    // let rowNo = $(pthis).attr('rowno');
    // if (isDIScreenLaunchReq) {
    //     apz.app.GroupsData.launchDeathIntFlow();
    // } else {
    if (!zeroFlowScrLaunchFlow) {
        ApzCOB.toggleModal(BaseScrId + 'confirmationModel');
    }
    let selectedGroupData = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
    currentValue = [...selectedGroupData];
    // let selectedGroupData = []
    $('#footer').addClass('sno');
    document.getElementById(grpDataScrId + 'row_groupsHeader').classList.add('sno');
    document.getElementById(grpDataScrId + 'row_gorupsDataRow').classList.add('sno');
    document.getElementById(grpDataScrId + 'row_footerDiv').classList.add('sno');
    // $('#APZCBO__BaseScreens__BaseDIV').addClass('sno')
    var launchObj = [];
    // selectedGroupData = kendraAttendance.filter((obj,i) => {
    //     if(obj.groupId === selectedGroupId) {
    //         return obj;
    //     }
    // })
    launchObj = JSON.parse(JSON.stringify(selectedGroupData));
    // if (isPartialCollection) {
    //     if (advanceCash) {
    //         launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COLL_TXT_FULL_COLL_SUC_MSG');
    //     } else {
    //         launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COLL_TXT_PARTIAL_SUC_MSG');
    //     }
    // } else {
    //     launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_FULLCASHSUCMSG');
    // }
    let collectedAmount = 0;
    let loanDueAmt = 0;
    let isParMemPresent = false;
    selectedGroupData.forEach((obj, i) => {
        loanDueAmt = 0;
        collectedAmount = 0;
        if (obj.totalAdv > 0) {
            let amtAdjInAdv = 0;
            if (obj.totalAdv > obj.totalDue) {
                amtAdjInAdv = obj.totalDue;
            } else {
                amtAdjInAdv = obj.totalAdv;
            }
            selectedGroupData.advAmtAdjusted = amtAdjInAdv;
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[i].advAmtAdjusted = amtAdjInAdv;
        }
        obj.loans.forEach((loan, j) => {
            loanDueAmt = loanDueAmt + loan.dueAmt;
            if (loan.cashAmt > 0) {
                collectedAmount = collectedAmount + loan.cashAmt;
            } else if (loan.upiAmt > 0) {
                collectedAmount = collectedAmount + loan.cashAmt;
            }
            if (collectedAmount < loanDueAmt) {
                isParMemPresent = true;
            }
        })
    })
    if (isParMemPresent) {
        launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COLL_TXT_PARTIAL_SUC_MSG');
    } else {
        launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COLL_TXT_FULL_COLL_SUC_MSG');
    }
    // launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COL_LBL_COL_SUB_MSG');
    if (isMarkCollectionEdition) {
        launchObj.succMsg = ApzCOB.getDescfromLitCode('LIT_COL_LBL_COL_SUB_EDIT_MSG');
    }
    var collectedAmt = document.getElementById(grpDataScrId + 'txt_cashToCollect').innerText;
    var groupName = document.getElementById(grpDataScrId + 'txt_groupName').innerText;
    launchObj.subHeader = '₹' + collectedAmt + ' Received (' + groupName + ')'
    launchObj.isFromGroupDetails = true;
    launchObj.moreInfo = apz.app.GroupsData.moreOptionsDropDownDetails(currentValue);
    let groupCustDet = {};
    for (var k = 0; k < selectedGroupData.length; k++) {
        let osTempAmt = 0;
        let cashCollTemp = 0;
        let dueAmtTemp = 0;
        let upiCollTemp = 0;
        osTempAmt = selectedGroupData[k].outstandingAmt;
        cashCollTemp = selectedGroupData[k].cashCollected;
        upiCollTemp = (selectedGroupData[k].upiCollected === undefined || selectedGroupData[k].upiCollected === "") ? 0 : selectedGroupData[k]
            .upiCollected
        dueAmtTemp = selectedGroupData[k].dueAmount;
        /*  selectedGroupData[k].outstandingAmt = osTempAmt.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(osTempAmt)) : parseInt(osTempAmt);
          selectedGroupData[k].cashCollected = cashCollTemp.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(cashCollTemp)) : parseInt(
              cashCollTemp);
          selectedGroupData[k].dueAmount = dueAmtTemp.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(dueAmtTemp)) : parseInt(dueAmtTemp);*/
        selectedGroupData[k].outstandingAmt = parseInt(String(osTempAmt).replace(/,/g, ''), 10);
        selectedGroupData[k].cashCollected = parseInt(String(cashCollTemp).replace(/,/g, ''), 10);
        selectedGroupData[k].dueAmount = parseInt(String(dueAmtTemp).replace(/,/g, ''), 10);
        selectedGroupData[k].upiCollected = parseInt(String(upiCollTemp).replace(/,/g, ''), 10);
    }
    groupCustDet.customerDetails = selectedGroupData;
    groupCustDet.kendraId = selectedKendra.kendraId;
    groupCustDet.kendraName = selectedKendra.kendraName;
    groupCustDet.groupId = selectedKendra.kendraName;
    groupCustDet.branchId = selectedKendra.kendraDet.branchId;
    groupCustDet.kmId = selectedKendra.kendraDet.kmId;
    groupCustDet.meetingDate = selectedKendra.meetingStartTime;
    // CollectionsCommon.storeCollCustDetSQLLite(groupCustDet);
    apz.app.GroupsData.storeCustomerSqlLite(selectedGroupData);
    $("#" + kmDashScrId + 'calculatorIcon').addClass('sno');
    ApzCOB.launchMicroApp("KenMet", "kenSuccessScreen", grpDataScrId + 'launchNextScrDiv', launchObj);
    //}
}
apz.app.GroupsData.moreOptionsDropDownDetails = function(data) {
    let totalDue = 0;
    let collAmount = 0;
    let cashCollected = 0;
    let upi = 0;
    let advUtilised = 0;
    let advanceCollection = 0;
    let netCollection = 0;
    let newParMem = 0;
    let pendingDueAmont = 0;
    let infoArr = '';
    let advanceAdjested = 0;
    let detailsArr = '';
    for (let i = 0; i < data.length; i++) {
        totalDue = totalDue + data[i].totalDue;
        collAmount = collAmount + data[i].collAmount;
        cashCollected = cashCollected + parseInt(String(data[i].cashCollected).replace(/,/g, ''), 10);
        netCollection = netCollection + parseInt(String(data[i].cashCollected).replace(/,/g, ''), 10);
        // pendingDueAmont = data[i].parFlg === 'Y' ? pendingDueAmont + data[i].parAmt : pendingDueAmont;
        pendingDueAmont =  pendingDueAmont + data[i].parAmt ;
        advUtilised += data[i].hasOwnProperty("advAmtAdjusted") ? data[i].advAmtAdjusted : 0;
        advanceAdjested += data[i].totalDue > 0 ? data[i].totalAdv : 0;
        upi = upi + (data[i].hasOwnProperty('upiCollected') ? parseInt(String(data[i].upiCollected).replace(/,/g, ''), 10) : 0);
        if (data[i].hasOwnProperty('advAmt')) {
            advanceCollection = advanceCollection + data[i].advAmt;
        }
    }
    if (isPartialCollection) {
        let count = 0;
        let selectedGroupData = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
        selectedGroupData.forEach(function(obj, i) {
            if (obj.parFlg === 'Y') {
                count = count + 1;
            }
        })
        infoArr = ['Total Due', 'Actual Payment', 'Cash', 'UPI', 'Advance', 'Advance utilised', 'PAR Members', 'Pending Due Amt'];
        detailsArr = ['₹ ' + ApzCOB.fn_FormatAmount(totalDue), '₹ ' + ApzCOB.fn_FormatAmount(collAmount), '₹ ' + ApzCOB.fn_FormatAmount(
                cashCollected), '₹ ' + ApzCOB.fn_FormatAmount(upi), '₹ ' + ApzCOB.fn_FormatAmount(advanceCollection), '₹ ' + ApzCOB
            .fn_FormatAmount(advanceAdjested), count, '₹ ' + (ApzCOB.fn_FormatAmount(pendingDueAmont))
        ];
    } else {
        let count = 0;
        let selectedGroupData = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
        selectedGroupData.forEach(function(obj, i) {
            if (obj.parFlg === 'Y') {
                count = count + 1;
            }
        })
        infoArr = ['Total Due', 'Actual Payment', 'Cash', 'UPI', 'Advance', 'Advance utilised', 'Par Members', 'Pending Due Amt'];
        detailsArr = ['₹ ' + ApzCOB.fn_FormatAmount(totalDue), '₹ ' + ApzCOB.fn_FormatAmount(collAmount), '₹ ' + ApzCOB.fn_FormatAmount(
                cashCollected), '₹ ' + ApzCOB.fn_FormatAmount(upi), '₹ ' + ApzCOB.fn_FormatAmount(advanceCollection), '₹ ' + ApzCOB
            .fn_FormatAmount(advanceAdjested), count, '₹ ' + ApzCOB.fn_FormatAmount(pendingDueAmont)
        ];
    }
    let paintArr = [];
    infoArr.forEach((d, idx) => {
        let obj = {};
        obj.info = d,
            obj.desc = detailsArr[idx];
        paintArr.push(obj)
    });
    return paintArr;
}
apz.app.GroupsData.storeCustomerSqlLite = function(params) {
    let totDue = 0;
    let totNetDue = 0;
    let totAdv = 0;
    let parAmt = 0;
    let groupId = document.getElementById(grpDataScrId + 'txt_groupName').innerText;
    params.forEach((obj, i) => {
        if (obj.hasOwnProperty('advAmt')) {
            totAdv = totAdv + obj.advAmt;
        }
        totNetDue = totNetDue + obj.netDue;
        totDue = totDue + obj.totalDue;
        parAmt = parAmt + obj.parAmt;
    })
    let collAmount = parseInt(ApzCOB.fn_unFormatAmount(document.getElementById(grpDataScrId + 'txt_cashToCollect').innerText));
    let custGroup = {};
    let selectedGrpDet = {};
    let selKenDet = JSON.parse(JSON.stringify(kendraDetails.kendraDet));
    custGroup.id = groupId.split(' ')[1];
    custGroup.members = params;
    custGroup.netDue = totNetDue;
    custGroup.totCollAmt = collAmount;
    custGroup.totalAdv = totAdv;
    custGroup.totalDue = totDue;
    custGroup.parAmt = parAmt;
    custGroup.isCollected = true;
    selectedGrpDet.customerDetails = custGroup;
    selectedGrpDet.kendraId = selKenDet.kendraId;
    selectedGrpDet.kendraName = selKenDet.kendraName;
    selectedGrpDet.groupId = groupId.split(' ')[1];
    selectedGrpDet.branchId = selKenDet.branchId;
    selectedGrpDet.kmId = selKenDet.kmId;
    selectedGrpDet.meetingDate = selKenDet.meetingDate;
    collectedGroupData = custGroup;
    apz.app.GroupsData.updateCollAmt(collectedGroupData);
    CollectionsCommon.storeCollCustDetSQLLite(selectedGrpDet);
    let kenDetWithStage = {};
    kenDetWithStage.kendraDet = kendraDetails.kendraDet;
    kenDetWithStage.currStage = "Loan Collection";
    // isCashierSubmission = true;
    // isFromFinalCashier = true;
    CollectionsCommon.insertIntoAppSQLLite(kenDetWithStage);
    CollectionsCommon.insertCollAppWFSQLLite(kendraDetails);
    // apz.app.GroupsData.storeUpdateKendraDet(custGroup);
}
apz.app.GroupsData.storeUpdateKendraDet = function(params) {
    kendraDetails.kendraDet.colldtls.groups.forEach((obj, i) => {
        if (obj.id === params.id) {
            kendraDetails.kendraDet.colldtls.groups[i] = params;
        }
    })
    collectionKendraData.forEach((ken, j) => {
        if (selectedKendra.kendraId === ken.kendraId) {
            collectionKendraData[j] = selectedKendra.kendraDet;
        }
    })
    CollectionsCommon.storeKendDetSQLLite(kendraDetails.kendraDet);
}
apz.app.GroupsData.onClickAmtOrQR = function(pthis, type) {
    isAmtOrQRText = type;
    if (type === "QR" && pthis.getAttribute('data-disabled') === 'true') {
        return;
    }
    selCustRowNo = $(pthis).attr('rowno');
    window.isQRSuccess = false;
    if (UPIAllowedForBranch && type === "QR") {
        ApzCOB.toggleModal(grpDataScrId + 'mdl_UPINotAllowedBranch');
    } else {
        document.getElementById(grpDataScrId + 'inp_enteredAmtVal').disabled = false;
        document.getElementById(grpDataScrId + 'icn_loanNextIcon_ul').classList.remove('sno');
        document.getElementById(grpDataScrId + 'icn_loanDetailsEditIcon_ul').classList.add('sno');
        document.getElementById(grpDataScrId + 'lst_loanDetList').classList.add('sno');
        document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.add('sno');
        document.getElementById(grpDataScrId + 'nav_submitBtn').classList.add('sno');
        document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.add('sno');
        document.getElementById(grpDataScrId + 'row_custEditAmtMainRow').classList.remove('sno');
        $("#" + grpDataScrId + "row_scanQrCodeLabelRow").addClass("sno");
        document.getElementById(grpDataScrId + 'row_col_Regenerateotp').classList.add('sno');
        document.getElementById(grpDataScrId + 'row_col_refIdRow').classList.add('sno');
        $("#" + grpDataScrId + "row_QRImageMainRow").addClass("sno");
        $('#' + grpDataScrId + "nav_col_custNameTimer").addClass("sno");
        selectedCustomerDetails = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo];
        var customerName = document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__customerName_' + selCustRowNo).innerText;
        ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
        document.getElementById(grpDataScrId + 'amtKeyPad').classList.remove('sno');
        $("#" + grpDataScrId + "mdl_amtEntryModal_close").removeClass('sno');
        document.getElementById(grpDataScrId + 'txt_selecCustName').innerText = 'For ' + customerName;
        // document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value = '';
        // document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value = ApzCOB.fn_unFormatAmount(document.getElementById(pthis.id).value);
        var customerColAmt = $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).val();
        document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value = ApzCOB.fn_unFormatAmount(customerColAmt);
        if (type === "cash") {
            // document.getElementById(grpDataScrId + 'mdl_OTPAuthModalold').innerText = ApzCOB.getDescfromLitCode('LIT_COLL__LBL_ADDAMTCASH_COLL_MODALID');
            document.querySelector('.modal-header h1').textContent = ApzCOB.getDescfromLitCode('LIT_COLL_LBL_ADDAMT_MODALID');
            $('#' + grpDataScrId + 'mdl_amtEntryModal_close').attr('onclick', '')
        } else if (type === "QR") {
            // document.getElementById(grpDataScrId + 'mdl_OTPAuthModalold').innerText = ApzCOB.getDescfromLitCode('LIT_ADDAMT_MODALID');
            document.querySelector('.modal-header h1').textContent = ApzCOB.getDescfromLitCode('LIT_COLL_LBL_ADDAMTCASH_COLL_MODALID');
            $('#' + grpDataScrId + 'mdl_amtEntryModal_close').attr('onclick', 'apz.app.GroupsData.onAmtEntryModalClose()')
        }
        // setTimeout(() => {
        let modal = document.getElementById(grpDataScrId + 'mdl_amtEntryModal');
        let inputField = document.getElementById(grpDataScrId + 'inp_enteredAmtVal');
        let submitButton = document.getElementById(grpDataScrId + 'icn_loanNextIcon');
        setTimeout(() => {
            inputField.setAttribute('readonly', true);
            inputField.focus();
            apz.app.GroupsData.hideKeyboard(inputField);
            inputField.hasFocusSet = true;
        }, 200)
        document.getElementById(grpDataScrId + 'ind_loan_div').classList.add('sno');
        document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.add('sno');
        inputField.classList.remove('err');
        submitButton.classList.remove('active');
        modal.addEventListener('shown.bs.modal', function() {
            inputField.focus();
            inputField.setAttribute('autocomplete', 'off');
            inputField.addEventListener('input', function() {
                if (inputField.value.length > 0) {
                    submitButton.classList.add('active');
                } else {
                    submitButton.classList.remove('active');
                }
            });
            // setTimeout(() => {
            //     apz.app.GroupsData.hideKeyboard(inputField);
            // }, 300);
        });
        // }, 100)
    }
}
apz.app.GroupsData.hideAmountError = function(pthis) {
    document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.add('sno');
    document.getElementById(grpDataScrId + 'inp_enteredAmtVal').classList.remove('err');
}
apz.app.GroupsData.onNextIconModalClick = function() {
    //commened below check as the background screen able to do actions
    // if ($('body').hasClass('modal-open')) {
    //      $('body').removeClass('modal-open');
    // }
    let loanAmts = 0;
    let AmtObj = [];
    let enteredAmt = document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value;
    if (enteredAmt === "" || enteredAmt === undefined) {
        enteredAmt = "0";
        document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value = "0";
    }
    let amount = parseInt(ApzCOB.fn_unFormatAmount(enteredAmt));
    let OSAmount = parseInt(ApzCOB.fn_unFormatAmount(selectedCustomerDetails.outstandingAmt));
    selectedCustomerDetails.loans.forEach((obj, i) => {
        loanAmts += obj.dueAmt;
        AmtObj.push(obj.dueAmt);
    });
    //commented below line for UNAP-1607 issue.
    // $('#' + grpDataScrId + 'txt_partialAmtText_' + selCustRowNo).closest('.srb').addClass('sno');
    // if (enteredAmt === "0" || enteredAmt === "0.00") {
    //     let totCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect');
    //     modalDIFlag = false;
    //     isDIScreenLaunchReq = true;
    //     $('#' + grpDataScrId + 'mdl_amtEntryModal_close').click();
    //     document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
    //     apz.app.GroupsData.paintCollectedAmt(totCollAmtId, 0);
    // } else
    let netdue = !apz.isNull(selectedCustomerDetails.netDue) ? selectedCustomerDetails.netDue : 0;
    if (parseInt(ApzCOB.fn_unFormatAmount(enteredAmt)) > (OSAmount + netdue) && parseInt(ApzCOB.fn_unFormatAmount(enteredAmt)) >
        selectedCustomerDetails.totalDue) {
        if (OSAmount === 0 || (OSAmount === netdue)) {
            document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.remove('sno');
            document.getElementById(grpDataScrId + 'inp_enteredAmtVal').classList.add('err');
            document.getElementById(grpDataScrId + 'txt_enteredAmtErrMsg').innerText = "Please enter Amount less than " + selectedCustomerDetails
            .totalDue;
        } else {
            document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.remove('sno');
            document.getElementById(grpDataScrId + 'inp_enteredAmtVal').classList.add('err');
            document.getElementById(grpDataScrId + 'txt_enteredAmtErrMsg').innerText = "Please enter Amount less than " + (OSAmount +
                netdue);
        }
    } else if (OSAmount === netdue && (parseInt(ApzCOB.fn_unFormatAmount(enteredAmt)) > netdue)) {
        document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.remove('sno');
        document.getElementById(grpDataScrId + 'inp_enteredAmtVal').classList.add('err');
        document.getElementById(grpDataScrId + 'txt_enteredAmtErrMsg').innerText = "Please enter Amount less than " + selectedCustomerDetails.totalDue;
    } else {
        document.getElementById(grpDataScrId + 'row_amtErrorMain').classList.add('sno');
        document.getElementById(grpDataScrId + 'inp_enteredAmtVal').classList.remove('err');
        let segregatedAmt = 0;
        inputEnteredAmt = 0;
        calcLoanAmount = 0;
        segregatedAmt = amount;
        inputEnteredAmt = amount;
        calcLoanAmount = loanAmts;
        segregAmountArr = splitAmtArr;
        dueAdvanceAmt = 0;
        isPartialCollection = true;
        partialCash = false;
        advanceCash = false;
        if (amount < selectedCustomerDetails.netDue) {
            dueAdvanceAmt = calcLoanAmount - (inputEnteredAmt + selectedCustomerDetails.totalAdv);
            partialCash = true;
            advanceCash = false;
            if (amount !== 0) {
                zeroCollectionFlow = false;
            }
        } else if (amount > selectedCustomerDetails.netDue) {
            advanceCash = true;
            zeroCollectionFlow = false;
            partialCash = false;
            dueAdvanceAmt = segregatedAmt;
            selectedCustomerDetails.loans.forEach(loan => {
                    loan.cashAmt = loan.dueAmt;
                    loan.parAmt = 0;
                })
        } else {
            partialCash = false;
            advanceCash = false;
            $('#' + grpDataScrId + 'txt_partialAmtText_' + selCustRowNo).closest('.srb').addClass('sno');
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.add('sno');
            document.getElementById(grpDataScrId + 'txt_col_memParFlag_' + selCustRowNo).classList.add('sno');
            let totCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect')
            apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
            if (isAmtOrQRText === 'cash') {
                if (selectedCustomerDetails.totalAdv === 0 && selectedCustomerDetails.totalDue > 0) {
                    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
                    document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = ApzCOB
                        .fn_FormatAmount(amount);
                } else if (selectedCustomerDetails.totalAdv > 0 && selectedCustomerDetails.netDue - selectedCustomerDetails.advAmt === amount) {
                    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
                    document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = ApzCOB
                        .fn_FormatAmount(amount);
                }
                selectedCustomerDetails.loans.forEach(loan => {
                    loan.cashAmt = loan.dueAmt;
                    loan.parAmt = 0;
                })
            }
        }
        if (isAmtOrQRText === 'cash') {
            document.getElementById(grpDataScrId + 'btn_submitBtnId').innerText = ApzCOB.getDescfromLitCode('LIT_COLL_LBL_ADD_AMOUNT');
            document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.add('sno');
            document.getElementById(grpDataScrId + 'lst_loanDetList').classList.remove('sno');
            document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.remove('sno');
            document.getElementById(grpDataScrId + 'nav_submitBtn').classList.remove('sno');
            document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.add('sno');
            $("#KenMet__GroupsData__mdl_amtEntryModal_close").addClass("sno")
            let entAmtTemp = parseInt(String(document.getElementById(grpDataScrId + "inp_enteredAmtVal").value).replace(/,/g, ''), 10);
            var advAmount = parseInt($("#" + grpDataScrId + 'txt_custAdvAmt_' + selCustRowNo).text().replace(/[^\d]/g, ''), 10);
            $("#" + grpDataScrId + 'advanceEntered').text("₹" + advAmount)
            $("#" + grpDataScrId + 'cashCollectedAdv').text("₹" + entAmtTemp);
            $("#" + grpDataScrId + 'totalAdvCalc').text("₹" + (entAmtTemp + parseInt(advAmount)))
            segregatedAmt = entAmtTemp + (parseInt(advAmount) || 0)
            // if (!apz.isNull($("#" + grpDataScrId + 'txt_custAdvAmt_' + selCustRowNo).text())) {
            //     let entAmtTemp = parseInt(String(document.getElementById(grpDataScrId + "inp_enteredAmtVal").value).replace(/,/g, ''), 10);
            //     var advAmount = $("#" + grpDataScrId + 'txt_custAdvAmt_' + selCustRowNo).text().match(/\d+/)[0];
            //     $("#" + grpDataScrId + 'advanceEntered').text("₹" + advAmount)
            //     $("#" + grpDataScrId + 'cashCollectedAdv').text("₹" + entAmtTemp);
            //     $("#" + grpDataScrId + 'totalAdvCalc').text("₹" + (entAmtTemp + parseInt(advAmount)))
            //     segregatedAmt = entAmtTemp + parseInt(advAmount)
            //     $("#" + grpDataScrId + 'totalAmountDue').text("₹" + (parseInt(ApzCOB.fn_unFormatAmount($(
            //         '#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__dueAmount_' + selCustRowNo).text()))))
            //     $("#" + grpDataScrId + 'totalSegregatedAmt').text("₹" + (entAmtTemp + parseInt(advAmount)));
            //     $("#" + grpDataScrId + 'advanceAmountForm').removeClass('sno');
            //     $("#" + grpDataScrId + 'totalAdvCalcDiv').removeClass('sno');
            //     $("#" + grpDataScrId + 'totalLoanCalDiv').addClass('sno');
            // } else {
            //     $("#" + grpDataScrId + 'advanceAmountForm').addClass('sno');
            //     $("#" + grpDataScrId + 'totalAdvCalcDiv').addClass('sno');
            //     $("#" + grpDataScrId + 'totalLoanCalDiv').removeClass('sno');
            // }
            $('#KenMet__GroupsData__btn_submitBtnId').attr('disabled', false);
        } else if (isAmtOrQRText === "QR") {
            document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.remove('sno');
            document.getElementById(grpDataScrId + 'btn_submitBtnId').innerText = ApzCOB.getDescfromLitCode('LIT_SUBMIT');
            document.getElementById(grpDataScrId + 'frm_QRDetForm').classList.remove('sno');
            document.getElementById(grpDataScrId + 'lst_loanDetList').classList.add('sno');
            document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.add('sno');
            document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.remove('sno');
            document.getElementById(grpDataScrId + 'nav_submitBtn').classList.remove('sno');
            $('#KenMet__GroupsData__btn_submitBtnId').attr('disabled', true);
            document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 1;
            $("#" + grpDataScrId + "row_succQRTickIcon").addClass('sno');
            $("#" + grpDataScrId + "row_col_paymentFailedRow").addClass('sno');
        }
        if (advanceCash) {
            if (deathIntGrpObj[selectedGrpId].includes(parseInt(selCustRowNo))) {
                deathIntGrpObj[selectedGrpId] = deathIntGrpObj[selectedGrpId].filter(number => number !== parseInt(selCustRowNo));
            }
            let advanceAmt = parseInt(enteredAmt.replace(/[^\d]/g, ''), 10) - selectedCustomerDetails.netDue;
            dueAdvanceAmt = advanceAmt;
            document.getElementById(grpDataScrId + 'txt_partialAmtText_' + selCustRowNo).classList.add('sno');
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.add('sno');
            document.getElementById(grpDataScrId + 'lst_loanDetList').classList.add('sno');
            document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.add('sno');
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).innerText = 'Advance';
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).classList.add("inf");
            document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + selCustRowNo).classList.add("inf");
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).classList.add("inf");
            ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
            ApzCOB.toggleModal(grpDataScrId + 'mdl_coll_advAmtModal');
            document.getElementById(grpDataScrId + 'txt_coll_advAmtModal').innerText = "Are you sure you want to collect ₹" + advanceAmt +
                " in Advance?";
            if (!document.body.classList.contains("mdl-opn")) {
                document.body.classList.add("mdl-opn");
            }
            if (!$('body').hasClass('modal-open')) {
                $('body').addClass('modal-open')
            }
        } else {
            if (amount === 0 && (selectedCustomerDetails.totalAdv === 0)) {
                //below line added to check if user entering zero
                deathIntGrpObj[selectedGrpId].push(parseInt(selCustRowNo))
                zeroCollectionFlow = true;
                apz.data.scrdata.KenMet__IPaintGroupData_Res = [];
                selectedCustomerDetails.loans.forEach(loan => {
                    loan.cashAmt = 0;
                    loan.upiAmt = 0;
                })
                apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails = selectedCustomerDetails.loans;
                let totCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect')
                apz.app.GroupsData.paintCollectedAmt(totCollAmtId, 0);
                apz.app.GroupsData.onClickSubmit();
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].isZeroCollection = true;
            } else {
                if (amount === 0) {
                    partialCash = true;
                    deathIntGrpObj[selectedGrpId].push(parseInt(selCustRowNo))
                    zeroCollectionFlow = true;
                    apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].isZeroCollection = true;
                } else {
                    zeroCollectionFlow = false;
                    apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].isZeroCollection = false;
                    let dueAmount = parseInt(selectedCustomerDetails.dueAmount.replace(/,/g, ''));
                    if (dueAmount === amount) {
                        deathIntGrpObj[selectedGrpId] = deathIntGrpObj[selectedGrpId].filter(number => number !== parseInt(selCustRowNo));
                    }
                }
                if (partialCash) {
                    document.getElementById(grpDataScrId + 'lst_loanDetList').classList.remove('sno');
                    document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.remove('sno');
                    document.getElementById(grpDataScrId + 'ind_loan_div').classList.remove('sno');
                    document.getElementById(grpDataScrId + 'nav_submitBtn').classList.remove('sno');
                    document.getElementById(grpDataScrId + 'inp_enteredAmtVal').disabled = true;
                    document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).classList.remove("inf");
                    document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + selCustRowNo).classList.remove("inf");
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).classList.remove("inf");
                    if (!apz.isNull($("#" + grpDataScrId + 'txt_custAdvAmt_' + selCustRowNo).text())) {
                        let entAmtTemp = parseInt(String(document.getElementById(grpDataScrId + "inp_enteredAmtVal").value).replace(/,/g, ''),
                        10);
                        var advAmount = parseInt($("#" + grpDataScrId + 'txt_custAdvAmt_' + selCustRowNo).text().replace(/[^\d]/g, ''), 10);
                        $("#" + grpDataScrId + 'advanceEntered').text("₹" + advAmount)
                        $("#" + grpDataScrId + 'cashCollectedAdv').text("₹" + entAmtTemp);
                        $("#" + grpDataScrId + 'totalAdvCalc').text("₹" + (entAmtTemp + parseInt(advAmount)))
                        segregatedAmt = entAmtTemp + parseInt(advAmount)
                        $("#" + grpDataScrId + 'totalAmountDue').text("₹" + (parseInt(ApzCOB.fn_unFormatAmount($(
                            '#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__dueAmount_' + selCustRowNo).text()))))
                        $("#" + grpDataScrId + 'totalSegregatedAmt').text("₹" + (entAmtTemp + parseInt(advAmount)));
                        $("#" + grpDataScrId + 'advanceAmountForm').removeClass('sno');
                        $("#" + grpDataScrId + 'totalAdvCalcDiv').removeClass('sno');
                        $("#" + grpDataScrId + 'totalLoanCalDiv').addClass('sno');
                    } else {
                        $("#" + grpDataScrId + 'advanceAmountForm').addClass('sno');
                        $("#" + grpDataScrId + 'totalAdvCalcDiv').addClass('sno');
                        $("#" + grpDataScrId + 'totalLoanCalDiv').removeClass('sno');
                    }
                    if (isAmtOrQRText === "QR") {
                        document.getElementById(grpDataScrId + 'txt_partialSegLabel').innerText = "UPI";
                    } else {
                        document.getElementById(grpDataScrId + 'txt_partialSegLabel').innerText = "Cash";
                    }
                }
                document.getElementById(grpDataScrId + 'amtKeyPad').classList.add('sno');
                document.getElementById(grpDataScrId + 'icn_loanNextIcon_ul').classList.add('sno');
                document.getElementById(grpDataScrId + 'icn_loanDetailsEditIcon_ul').classList.remove('sno');
                apz.data.scrdata.KenMet__IPaintGroupData_Res = [];
                apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails = selectedCustomerDetails.loans;
                apz.data.loadData('IPaintGroupData', 'KenMet');
                //below code added for showing loan total amt
                let loanTotal = 0
                apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((d, i) => {
                    loanTotal = loanTotal + d.dueAmt
                });
                AmtObj.forEach((amt, j) => {
                    if (segregatedAmt > amt) {
                        document.getElementById(grpDataScrId + 'inp_disburseAmtVal_' + j).value = amt;
                        segregatedAmt -= amt;
                        splitAmtArr.push(amt);
                    } else if (amt >= segregatedAmt) {
                        document.getElementById(grpDataScrId + 'inp_disburseAmtVal_' + j).value = segregatedAmt;
                        splitAmtArr.push(segregatedAmt);
                        segregatedAmt = 0;
                    } else if (segregatedAmt === 0) {
                        document.getElementById(grpDataScrId + 'inp_disburseAmtVal_' + j).value = 0;
                        splitAmtArr.push(segregatedAmt);
                    }
                    $('#' + grpDataScrId + 'inp_disburseAmtVal_' + j).attr('readonly', false);
                    $("#" + grpDataScrId + 'amtErrorField_' + j).parents().eq(1).addClass('sno');
                    $("#" + grpDataScrId + 'inp_disburseAmtVal_' + j).attr('onblur', 'apz.app.GroupsData.onBlurLoanAmount(this)');
                });
                //below code added for showing loan partial total amt
                let loanPartailAmt = parseInt((document.getElementById(grpDataScrId + "inp_enteredAmtVal").value).replace(/,/g, ''), 10);
                // AmtObj.forEach((d) => {
                //     loanPartailAmt = loanPartailAmt + d;
                // });
                apz.setElmValue(grpDataScrId + 'totalLoanAmt', '(' + ApzCOB.getDescfromLitCode('LIT_COL_LBL_TOT_ONLY') + ' ₹ ' + loanTotal +
                    ' ) ');
                apz.setElmValue(grpDataScrId + 'partialPayLoanAmt', '(' + ApzCOB.getDescfromLitCode('LIT_COL_LBL_TOT_ONLY') + ' ₹ ' +
                    loanPartailAmt + ' ) ');
            }
        }
    }
}
apz.app.GroupsData.onClickEditBtn = function() {
    document.getElementById(grpDataScrId + 'amtKeyPad').classList.remove('sno');
    document.getElementById(grpDataScrId + 'inp_enteredAmtVal').disabled = false;
    document.getElementById(grpDataScrId + 'icn_loanNextIcon_ul').classList.remove('sno');
    document.getElementById(grpDataScrId + 'icn_loanDetailsEditIcon_ul').classList.add('sno');
    document.getElementById(grpDataScrId + 'lst_loanDetList').classList.add('sno');
    document.getElementById(grpDataScrId + 'nav_submitBtn').classList.add('sno');
    document.getElementById(grpDataScrId + 'AmountAgainstLoanDiv').classList.add('sno');
    if (isAmtOrQRText === 'cash') {
        // document.getElementById(grpDataScrId + 'btn_submitBtnId').innerText = ApzCOB.getDescfromLitCode('LIT_ADD_AMOUNT');
    } else if (isAmtOrQRText === "QR") {
        document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.add('sno');
        // document.getElementById(grpDataScrId + 'btn_submitBtnId').innerText = ApzCOB.getDescfromLitCode('LIT_SUBMIT');
    }
    const inputField = document.getElementById(grpDataScrId + "inp_enteredAmtVal");
    setTimeout(() => {
        inputField.focus();
        apz.app.GroupsData.hideKeyboard(inputField);
    }, 200);
}
apz.app.GroupsData.partailPayErrDisCB = function(params) {
    $('body').removeClass('mdl-opn');
    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
}
apz.app.GroupsData.onClickSubmit = function() {
    if (!$('body').hasClass('modal-open')) {
        $('body').addClass('modal-open')
    }
    if (!document.body.classList.contains("mdl-opn")) {
        document.body.classList.add("mdl-opn");
    }
    if (partialCash) {
        let totaldisbursed = 0;
        let inputedAmt = document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value;
        if (apz.data.scrdata.KenMet__IPaintGroupData_Res) {
            totaldisbursed = apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.reduce((acc, _, i) => {
                let disburseAmt = $("#" + grpDataScrId + 'inp_disburseAmtVal_' + i).val();
                //modified below change for UAT JIRA issue UNAP-1200 on 11-02-2025
                return acc + (disburseAmt ? parseInt(String(disburseAmt).replace(/,/g, ''), 10) || 0 : 0);
            }, 0);
        }
        if (totaldisbursed < parseInt(ApzCOB.fn_unFormatAmount(inputedAmt))) {
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COL_MSG_LESSAMOUNTMSG"), "E", apz.app.GroupsData.partailPayErrDisCB);
            ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
            return;
        }
        if (selectedCustomerDetails.totalAdv > 0 && (totaldisbursed - parseInt(selectedCustomerDetails.totalAdv) != parseInt(ApzCOB
                .fn_unFormatAmount(inputedAmt)))) {
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COL_MSG_LESSAMOUNTMSG"), "E", apz.app.GroupsData.partailPayErrDisCB);
            ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
            return;
        }
        //below code added for zero collection flow
        if (parseInt(inputedAmt) === 0) {
            ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = 0;
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].cashCollected = 0;
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalCash = 0;
            let totCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect')
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = 0
            //ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
             $("#" + grpDataScrId + "parColTxt_" + selCustRowNo).addClass('bg-dark-err');
            let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + selCustRowNo);
            mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.add("sno");
            if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv > 0) {
                apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((loan, l) => {
                    let loanCollAmt = parseInt(ApzCOB.fn_unFormatAmount($("#" + grpDataScrId + 'inp_disburseAmtVal_' + l).val()));
                    if (isAmtOrQRText === "QR") {
                        apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[l].upiAmt = loanCollAmt;
                    } else {
                        apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[l].cashAmt = loanCollAmt;
                    }
                });
            } else {
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].loans.forEach((list, k) => {
                    list.cashAmt = 0;
                });
            }
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.remove('sno');
            document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).closest('.srb').classList.add('sno');
        } else {
            /* if (gLovs && gLovs.lovDtls) {
                 parReasonsArr = JSON.parse(gLovs.lovDtls).map((d) => ({
                     reason: d.value
                 }));
             }*/
            if (deathIntGrpObj[selectedGrpId].includes(parseInt(selCustRowNo))) {
                deathIntGrpObj[selectedGrpId] = deathIntGrpObj[selectedGrpId].filter(number => number !== parseInt(selCustRowNo));
            }
            apz.data.scrdata.KenMet__IPaintPartailPayment_Res = [];
            apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason = [];
            apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason = parReasonsArr;
            apz.data.loadData("IPaintPartailPayment", 'KenMet');
            let customerDetails = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo];
            let isParFlagged = customerDetails.parFlg === 'Y';
            let hasCurrentParStatus = customerDetails.hasOwnProperty('isCurrentCustPar') && customerDetails.isCurrentCustPar === true;
            let isZeroCollection = customerDetails.hasOwnProperty('isZeroCollection') && customerDetails.isZeroCollection;
            //below code added if the customer advance is getting adjusted adding data to the vaiable
            if (customerDetails.collAmount < customerDetails.totalDue || (customerDetails.totalAdv > 0 && customerDetails.totalDue === 0)) {
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAmtAdjusted = customerDetails.totalAdv;
            } else {
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAmtAdjusted = 0;
            }
            if (isParFlagged && hasCurrentParStatus && isZeroCollection) {
                apz.app.GroupsData.onClickSubmiPartialPayment();
            } else {
                ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
                ApzCOB.toggleModal(grpDataScrId + 'partialModel');
                if (!$('body').hasClass('modal-open')) {
                    $('body').addClass('modal-open')
                }
                $("#KenMet__GroupsData__partialModel_close").removeClass('sno');
                // if (isAmtOrQRText === "QR") {
                //     document.getElementById(grpDataScrId + "partialModel_close").classList.add('sno');
                // } else {
                //     document.getElementById(grpDataScrId + "partialModel_close").classList.remove('sno');
                // }//need to uncomment above for UAT JIRA UNAP-1126
                document.getElementById(grpDataScrId + "partialModel_close").classList.add('sno');
                apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
                    $("#" + grpDataScrId + 'resChk_' + i).prop('checked', false);
                    document.getElementById(grpDataScrId + 'resChk_' + i).disabled = false;
                    let listDiv = document.querySelector("#" + grpDataScrId + "reasonsList_row_" + i);
                    listDiv.querySelector("#" + grpDataScrId + 'deathClaim_row').classList.add('sno');
                    listDiv.querySelector("#" + grpDataScrId + 'reasonsDiv_row').classList.add('sno');
                    listDiv.querySelector("#" + grpDataScrId + 'row_otherReasonMainRow_row').classList.add('sno');
                    // Clear inputs
                    document.getElementById(grpDataScrId + "inp_otherReasonInp_" + i).value = '';
                    document.getElementById(grpDataScrId + "fam_mem_name_" + i).value = '';
                    document.getElementById(grpDataScrId + "fam_mem_mob_" + i).value = '';
                })
                apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((loan, l) => {
                    let loanCollAmt = parseInt(ApzCOB.fn_unFormatAmount($("#" + grpDataScrId + 'inp_disburseAmtVal_' + l).val()));
                    if (isAmtOrQRText === "QR") {
                        apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[l].upiAmt = loanCollAmt;
                    } else {
                        apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[l].cashAmt = loanCollAmt;
                    }
                })
            }
        }
    } else {
        advModalOpenCount = 0;
        apz.app.GroupsData.onClickSubmiPartialPayment();
    }
}
apz.app.GroupsData.paintCollectedAmt = function(inputId, amoutCol) {
    if (($('body').hasClass('modal-open')) || document.body.classList.contains("mdl-opn")) {
        $('body').removeClass('modal-open');
        document.body.classList.remove("mdl-opn");
    }
    let totColAmt = inputId.innerText.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(inputId.innerText)) : parseInt(inputId.innerText);
    if (isAmtOrQRText === "QR") {
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].upiCollected = amoutCol;
    } else {
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].cashCollected = amoutCol;
        $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).attr('data-disabled', true);
        document.getElementById(grpDataScrId + 'qrScanIcon_' + selCustRowNo).style.opacity = 0.4;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = amoutCol;
    }
    //commented below and added above as we need In progress and failed UPI to calculate
    // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = amoutCol;
    if (partialCash) {
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parFlg = "Y";
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].isCurrentCustPar = true;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parAmt = dueAdvanceAmt;
        ApzCOB.fn_FormatAmount(apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue - parseInt(amoutCol))
        $("#" + grpDataScrId + "parColTxt_" + selCustRowNo).addClass('bg-dark-err');
    } else {
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parFlg = "N";
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parAmt = 0;
        $("#" + grpDataScrId + "parColTxt_" + selCustRowNo).removeClass('bg-dark-err');
        let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + selCustRowNo);
        mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.add("sno");
    }
    let prevCollAdvAmt = 0;
    if (advanceCash) {
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAdj = dueAdvanceAmt;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAmt = dueAdvanceAmt;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAdj = 0;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].isCurrentCustPar = false
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv = dueAdvanceAmt;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].loans.forEach((loan, l) => {
            if (isAmtOrQRText === "QR") {
                loan.upiAmt = loan.dueAmt;
            } else {
                loan.cashAmt = loan.dueAmt;
            }
            loan.parAmt = 0;
        })
    } else {
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAdj = 0;
        prevCollAdvAmt = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAmt;
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].advAmt = 0;
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv = 0;
    }
    // let selecMem = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo]
    let selecMemAMt = $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).val()
    selecMemAMt = selecMemAMt.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(selecMemAMt)) : parseInt(selecMemAMt);
    let calTotalAmt = 0;
    let dueAmtToRemove = 0;
    if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet.length > 1) {
        if (totColAmt > 0) {
            if (amoutCol === 0) {
                //modified below logic for UNAP-1288
                if (selecMemAMt === 0) {
                    dueAmtToRemove = 0;
                } else if (selecMemAMt < (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue +
                    prevCollAdvAmt)) {
                    dueAmtToRemove = selecMemAMt;
                } else {
                    dueAmtToRemove = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue;
                }
                // calTotalAmt = (totColAmt - (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue +
                //     prevCollAdvAmt)) + parseInt(amoutCol);
                calTotalAmt = (totColAmt - (dueAmtToRemove + prevCollAdvAmt)) + parseInt(amoutCol);
            } else {
                calTotalAmt = (totColAmt - selecMemAMt) + parseInt(amoutCol);
            }
        } else {
            if (amoutCol > 0) {
                calTotalAmt = parseInt(amoutCol);
            } else {
                calTotalAmt = 0;
            }
        }
    } else {
        if (totColAmt > 0) {
            if (amoutCol === 0) {
                calTotalAmt = 0;
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = ApzCOB.fn_FormatAmount(apz.data
                    .scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue)
            } else {
                // calTotalAmt = totColAmt - parseInt(amoutCol);
                calTotalAmt = amoutCol;
                //modified below on 17/002/2025 for UNAP-1228
                // document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = ApzCOB.fn_FormatAmount(apz.data
                //     .scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue - parseInt(amoutCol))
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
            }
        } else {
            if (amoutCol === 0) {
                calTotalAmt = 0;
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = ApzCOB.fn_FormatAmount(apz.data
                    .scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue)
            } else {
                calTotalAmt = amoutCol;
                //added check for UNAP-1538
                if (advanceCash) {
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
                } else {
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = ApzCOB.fn_FormatAmount(apz.data
                        .scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].netDue - parseInt(amoutCol));
                }
            }
        }
    }
    inputId.innerText = ApzCOB.fn_FormatAmount(calTotalAmt);
    if (isAmtOrQRText === 'QR') {
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].cashCollected = 0;
    } else {
        document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = ApzCOB.fn_FormatAmount(
            amoutCol);
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].upiCollected = 0;
    }
    // apz.app.GroupsData.updateCollAmt();
}
apz.app.GroupsData.onClickPartialAmtMark = function(pthis) {
    ApzCOB.toggleModal(grpDataScrId + 'mdl_coll_postCashColl');
    selCustRowNo = $(pthis).attr('rowno');
    var CustomerDet = JSON.parse(JSON.stringify(apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo]));
    var customerName = document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__customerName_' + selCustRowNo).innerText;
    var custDueAmt = document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__dueAmount_' + selCustRowNo).innerText;
    document.getElementById(grpDataScrId + 'txt_coll_selecLoanCustName').innerText = "For " + customerName + " (Due₹" + custDueAmt + ")"
    var totCashAmt = 0;
    var totUPIAmt = 0;
    CustomerDet.loans.forEach((obj, i) => {
        totCashAmt = totCashAmt + obj.cashAmt;
        totUPIAmt = totUPIAmt + obj.upiAmt;
        obj.totalAmt = obj.cashAmt + obj.upiAmt;
        obj.upiAmt = obj.upiAmt === 0 ? '-' : obj.upiAmt;
        obj.cashAmt = obj.cashAmt === 0 ? '-' : obj.cashAmt;
        obj.totalAmt = obj.totalAmt === 0 ? '-' : obj.totalAmt;
    })
    apz.data.scrdata.KenMet__IPaintLoansDetails_Res = [];
    apz.data.scrdata.KenMet__IPaintLoansDetails_Res.LoanDetails = [];
    apz.data.scrdata.KenMet__IPaintLoansDetails_Res.LoanDetails = CustomerDet.loans;
    apz.data.loadData('IPaintLoansDetails', 'KenMet');
    document.getElementById(grpDataScrId + 'txt_partialTotCashAmt').innerText = totCashAmt === 0 ? '-' : "₹" + totCashAmt;
    document.getElementById(grpDataScrId + 'txt_partialTotUPI').innerText = totUPIAmt === 0 ? '-' : "₹" + totUPIAmt;
    let totalAmount = totCashAmt + totUPIAmt;
    document.getElementById(grpDataScrId + 'txt_partialTotAmount').innerText = totalAmount === 0 ? '-' : "₹" + totalAmount;
    CustomerDet.loans.forEach((loan, j) => {
        if (j === 0) {
            document.getElementById(grpDataScrId + 'txt_col_loanDetHeaderId_' + j).closest('.grp-row').classList.remove('sno');
        } else {
            document.getElementById(grpDataScrId + 'txt_col_loanDetHeaderId_' + j).closest('.grp-row').classList.add('sno');
        }
        if (loan.totalAmt === '-') {
            $("#KenMet__IPaintLoansDetails__o__LoanDetails__totalAmt_" + j).find('svg').addClass('sno');
        }
        if (loan.upiAmt === '-') {
            $("#KenMet__IPaintLoansDetails__o__LoanDetails__upiAmt_" + j).find('svg').addClass('sno');
        }
        if (loan.cashAmt === '-') {
            $("#KenMet__IPaintLoansDetails__o__LoanDetails__cashAmt_" + j).find('svg').addClass('sno');
        }
    })
}
document.getElementById(grpDataScrId + 'mdl_coll_advAmtModal_close').addEventListener('click', () => {
    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal')
})
apz.app.GroupsData.onClickAdvCancelBtn = function() {
    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal')
}
apz.app.GroupsData.launchDeathIntFlow = function() {
    // $('#' + grpDataScrId + 'mdl_amtEntryModal_close').click();
    var launchObj = {};
    launchObj.fromFlag = "zeroCollection";
    launchObj.kendraId = kendraDetails.kendraDet.kendraId;
    launchObj.customerId = apz.userId;
    document.getElementById(grpDataScrId + 'row_groupsHeader').classList.add('sno');
    document.getElementById(grpDataScrId + 'row_gorupsDataRow').classList.add('sno');
    document.getElementById(grpDataScrId + 'row_footerDiv').classList.add('sno');
    zeroEnteredFeild = deathIntGrpObj[selectedGrpId];
    ApzCOB.launchMicroApp("KenMet", "DeathIntimation", grpDataScrId + 'launchNextScrDiv', launchObj);
}
apz.app.GroupsData.fromDeathIntFLow = function(params) {
    document.getElementById(grpDataScrId + 'launchNextScrDiv').classList.add('sno');
    document.getElementById(grpDataScrId + 'row_groupsHeader').classList.remove('sno');
    document.getElementById(grpDataScrId + 'row_gorupsDataRow').classList.remove('sno');
    document.getElementById(grpDataScrId + 'row_footerDiv').classList.remove('sno');
    isDIScreenLaunchReq = false;
    apz.app.GroupsData.launchSuccessScreen()
}
apz.app.GroupsData.onClickNumberKeyPad = function(pthis) {
    let numSel = pthis.id.split("_").at(-1);
    keypadClicked = true;
    // let enteredVal = ApzCOB.fn_unFormatAmount(apz.getElmValue(grpDataScrId + 'inp_enteredAmtVal'));
    // if (numSel === 'b') {
    //     apz.setElmValue(grpDataScrId + 'inp_enteredAmtVal', ApzCOB.fn_FormatAmount(enteredVal.slice(0, -1)));
    // } else {
    //     if (enteredVal.length < 7) {
    //         apz.setElmValue(grpDataScrId + 'inp_enteredAmtVal', ApzCOB.fn_FormatAmount(enteredVal + numSel));
    //     }
    // }
    const inputField = document.getElementById(grpDataScrId + "inp_enteredAmtVal");
    if (inputField.value.length >= inputField.maxLength) {
        return; // Do nothing if max length is reached
    }
    const start = inputField.selectionStart;
    const end = inputField.selectionEnd;
    const before = inputField.value.substring(0, start);
    const after = inputField.value.substring(end, inputField.value.length);
    inputField.value = before + numSel + after;
    const newPosition = start + numSel.length;
    inputField.setSelectionRange(newPosition, newPosition);
    inputField.focus();
    apz.app.GroupsData.hideKeyboard(inputField);
    apz.app.GroupsData.unFormatEnteredAmount(inputField);
}
apz.app.GroupsData.onClearInputValue = function(pthis) {
    const inputField = document.getElementById(grpDataScrId + "inp_enteredAmtVal");
    keypadClicked = true;
    const start = inputField.selectionStart;
    const end = inputField.selectionEnd;
    if (start !== end) {
        inputField.value = inputField.value.slice(0, start) + inputField.value.slice(end);
        inputField.setSelectionRange(start, start); // Set cursor after the deleted selection
    } else if (start > 0) {
        inputField.value = inputField.value.slice(0, start - 1) + inputField.value.slice(start);
        inputField.setSelectionRange(start - 1, start - 1); // Set cursor after the deleted character
    }
    inputField.focus();
    apz.app.GroupsData.hideKeyboard(inputField);
    apz.app.GroupsData.unFormatEnteredAmount(inputField);
}
apz.app.GroupsData.reasonCB = function(params) {
    ApzCOB.toggleModal(grpDataScrId + 'partialModel');
    if ($('body').hasClass('mdl-opn')) {
        $('body').addClass('mdl-opn')
    }
    let btn = document.getElementById("KenMet__GroupsData__el_btn_34");
    if (btn.disabled) {
        btn.disabled = false;
    } else {
        btn.disabled = true;
    }
}
apz.app.GroupsData.onClickSubmiPartialPayment = function() {
    // if (document.body.classList.contains("mdl-opn")) {
    //     document.body.classList.remove("mdl-opn");
    // }
    let totCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect')
    let totCollAmt = totCollAmtId.innerText.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(totCollAmtId.innerText)) : parseInt(totCollAmtId
        .innerText);
    isErr = false;
    let today = new Date();
    let dd = String(today.getDate()).padStart(2, '0');
    let mm = String(today.getMonth() + 1).padStart(2, '0');
    let yyyy = today.getFullYear();
    let value = '';
    let index = 0;
    let c = '';
    if (partialCash) {
        zeroFlowScrLaunchFlow = false;
        resonForPartialPay = '';
        // let isErr = false;
        var noSelectCount = 0;
        apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
            if ($("#" + grpDataScrId + 'resChk_' + i).prop('checked')) {
                index = i;
                value = d.reason;
            }
        });
        let liId = document.getElementById(grpDataScrId + "reasonsList_row_" + index);
        let inoutBxVal = document.getElementById(grpDataScrId + 'inp_otherReasonInp_' + index).value;
        if (apz.isNull(value)) {
            //ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_PLE_SEL_REASON"), "E");
            $("#KenMet__GroupsData__el_txt_161_txtcnt").text(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_PLE_SELECT_REASON"))
            $("#KenMet__KMDashboard__calculatorIcon").addClass('sno');
            ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
        } else if (value === "Others" && apz.isNull(inoutBxVal)) {
            // ApzCOB.toggleModal(grpDataScrId + 'customAlertModel');
            $("#KenMet__GroupsData__el_txt_161_txtcnt").text(ApzCOB.getDescfromLitCode("Please select reason to continue"))
            $("#KenMet__KMDashboard__calculatorIcon").addClass('sno');
            ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
        } else if (apz.app.GroupsData.isClaimFormEntered(value, index)) {
            // ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COL_ERR_PLS_ENT_MEM_NAME_NUM"), "E");
            ApzCOB.toggleModal(grpDataScrId + 'customAlertModel');
            $("#KenMet__GroupsData__el_txt_161_txtcnt").text(ApzCOB.getDescfromLitCode("LIT_COL_ERR_PLS_ENT_MEM_NAME_NUMBER"))
            $("#KenMet__KMDashboard__calculatorIcon").addClass('sno');
            ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
        } else if (apz.app.GroupsData.checkValideMobileNo(value, index)) {
            // ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_VALID_PHONE_NO"), "E");
            ApzCOB.toggleModal(grpDataScrId + 'customAlertModel');
            $("#KenMet__GroupsData__el_txt_161_txtcnt").text(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_VALID_PHONE_NUM"))
            $("#KenMet__KMDashboard__calculatorIcon").addClass('sno');
            ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
        }
        // document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
        if (!apz.isNull(apz.data.scrdata.KenMet__IPaintPartailPayment_Res)) {
            apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
                if ($("#" + grpDataScrId + 'resChk_' + i).prop('checked')) {
                    if (document.getElementById('KenMet__IPaintPartailPayment__o__IPaintPartialPayReason__reason_' + i + '_txtcnt')
                        .innerText === "Others") {
                        let otherReason = document.getElementById(grpDataScrId + 'inp_otherReasonInp_' + i).value;
                        if (apz.isNull(otherReason) || otherReason === "") {
                            let listDiv = document.querySelector("#" + grpDataScrId + "reasonsList_row_" + i);
                            //document.getElementById(grpDataScrId + 'row_otherReasonMainRow').classList.remove('sno');
                            listDiv.querySelector("#" + grpDataScrId + 'row_otherReasonMainRow_row').classList.remove('sno');
                            isErr = true;
                        } else {
                            resonForPartialPay = otherReason;
                        }
                    } else {
                        resonForPartialPay = d.reason;
                    }
                } else {
                    noSelectCount++;
                }
            });
        }
    }
    if (!apz.isNull(apz.data.scrdata.KenMet__IPaintPartailPayment_Res) && (isErr || noSelectCount === apz.data.scrdata
            .KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.length)) {
        ApzCOB.toggleModal(grpDataScrId + 'partialModel');
        ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_PLE_SEL_REASON"), "E", apz.app.GroupsData.reasonCB);
        return;
    }
    if (apz.isNull(resonForPartialPay) && partialCash && apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo]
        .parFlg === 'N') {
        ApzCOB.toggleModal(grpDataScrId + 'partialModel');
        ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_PLE_SEL_REASON"), "E", apz.app.GroupsData.reasonCB);
    } else {
        if (zeroCollectionFlow) {
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = 0
            document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
            //ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].loans.forEach((list, k) => {
                list.cashAmt = 0;
            })
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.remove('sno');
        } else if (advanceCash) {
            zeroFlowScrLaunchFlow = false;
            $('#' + grpDataScrId + 'mdl_amtEntryModal_close').click();
            // document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).closest('.srb').classList.remove('sno');
            // document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
            if (isAmtOrQRText === 'cash') {
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).closest('.srb').classList.remove('sno');
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
                if (advanceCash) {
                    document.getElementById(grpDataScrId + 'txt_partialAmtText_' + selCustRowNo).classList.add('sno');
                    document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.add('sno');
                    document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).innerText = 'Advance';
                    document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).classList.add("inf");
                    document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).classList.add("inf");
                    document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + selCustRowNo).classList.add("inf");
                    //document.getElementById(grpDataScrId + 'partialCollectedDiv_' + selCustRowNo).classList.add('sno');
                    let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + selCustRowNo);
                    mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.add("sno");
                    ApzCOB.toggleModal(grpDataScrId + 'mdl_coll_advAmtModal');
                    document.getElementById(grpDataScrId + 'txt_coll_advAmtModal').innerText = "Are you sure you want to collect ₹" +
                        dueAdvanceAmt + " in Advance?"
                }
            } else if (isAmtOrQRText === 'QR') {
                //   document.getElementById(grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).innerText = "₹" + inputEnteredAmt;
                ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
                if (advModalOpenCount === 0) {
                    ApzCOB.toggleModal(grpDataScrId + 'mdl_coll_advAmtModal');
                    advModalOpenCount++;
                } else if (isAmtOrQRText === "QR" && advModalOpenCount === 1) {
                    advModalOpenCount = 0;
                }
                let inputField = document.getElementById(grpDataScrId + 'inp_enteredAmtVal');
                setTimeout(() => {
                    apz.app.GroupsData.hideKeyboard(inputField);
                    if (!$('body').hasClass('modal-open')) {
                        $('body').addClass('modal-open')
                    }
                }, 200)
                document.getElementById(grpDataScrId + 'amtKeyPad').classList.add('sno');
                document.getElementById(grpDataScrId + 'icn_loanNextIcon_ul').classList.add('sno');
                document.getElementById(grpDataScrId + 'icn_loanDetailsEditIcon_ul').classList.remove('sno');
                document.getElementById(grpDataScrId + 'inp_enteredAmtVal').disabled = true;
                // document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__upiCollected_' + selCustRowNo).value = inputEnteredAmt
                // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].upiCollected = inputEnteredAmt;
                // document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
            }
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount = inputEnteredAmt;
            if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].hasOwnProperty('UPIStatus')) {
                if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus === "INPROGRESS" || apz.data.scrdata
                    .KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus === "FAIL") {
                    apz.app.GroupsData.paintCollectedAmt(totCollAmtId, 0);
                } else {
                    apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
                }
            } else if (isAmtOrQRText === 'cash') {
                apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
            }
        } else if (partialCash) {
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).closest('.srb').classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
            document.getElementById(grpDataScrId + 'txt_partialAmtText_' + selCustRowNo).classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).classList.add("war");
            document.getElementById(grpDataScrId + 'icn_coll_infoErrorIcon_' + selCustRowNo).classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_afterAmountId_' + selCustRowNo).innerText = ' )';
            document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).classList.remove("inf");
            // document.getElementById(grpDataScrId + 'partialCollectedDiv_' + selCustRowNo).classList.remove('sno');
            let mainDiv = document.querySelector("#" + grpDataScrId + "lst_col_groupMainList_row_" + selCustRowNo);
            mainDiv.querySelector('#' + grpDataScrId + 'partialCollectedDiv_row').classList.remove("sno");
            document.getElementById(grpDataScrId + 'txt_parAdvRupeeSym_' + selCustRowNo).classList.remove("inf");
            splitAmtArr = [];
            apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((obj, i) => {
                duamt = document.getElementById(grpDataScrId + 'inp_disburseAmtVal_' + i).value
                duamt = parseInt(String(duamt).replace(/,/g, ''));
                splitAmtArr[i] = +duamt;
            });
            segregAmountArr = splitAmtArr;
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].loans.forEach((list, k) => {
                if (isAmtOrQRText === 'QR') {
                    list.upiAmt = segregAmountArr[k];
                } else {
                    list.cashAmt = segregAmountArr[k];
                }
                if (segregAmountArr[k] < list.dueAmt) {
                    list.parAmt = list.dueAmt - segregAmountArr[k]
                }
            });
            let customerDetails = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo];
            let isZeroCollection = customerDetails.hasOwnProperty('isZeroCollection') && customerDetails.isZeroCollection;
            if (apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parFlg === 'N' || (apz.data.scrdata
                    .KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].parFlg === 'Y' && !apz.data.scrdata
                    .KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].hasOwnProperty('isCurrentCustPar')) || !isZeroCollection) {
                ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            } else {
                ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
            }
            apz.app.GroupsData.paintCollectedAmt(totCollAmtId, inputEnteredAmt);
        } else if (isAmtOrQRText === 'QR') {
            ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
        }
        if (isAmtOrQRText === 'QR') {
            //commented below lines for UAT issue UNAP-1125
            // $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).val(0)
            // $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).attr('disabled', true);
            // $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).attr('data-disabled', true);
            // document.getElementById(grpDataScrId + 'qrScanIcon_' + selCustRowNo).style.opacity = 0.4;
            let custDetails = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo];
            // totUPICollAmtId.innerText = ApzCOB.fn_FormatAmount(totUPIColAmt + inputEnteredAmt);
            if (custDetails.hasOwnProperty('UPIStatus')) {
                //added below 7 lines to change amount status post paying QR amount for UNAT issue UNAP-1125
                $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).val(0)
                $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).attr('disabled', true);
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).closest('.srb').classList.remove('sno');
                document.getElementById(grpDataScrId + 'txt_partialAmtPaintId_' + selCustRowNo).innerText = dueAdvanceAmt;
                $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).attr('data-disabled', true);
                document.getElementById(grpDataScrId + 'qrScanIcon_' + selCustRowNo).style.opacity = 0.4;
                document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].cashCollected = 0;
                apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].paymentFlg = "UPI";
                let totCashCollAmtId = document.getElementById(grpDataScrId + 'txt_cashToCollect');
                let totUPICollAmtId = document.getElementById(grpDataScrId + 'txt_UPICollection');
                let totCashColAmt = totCollAmtId.innerText.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(totCollAmtId.innerText)) : parseInt(
                    totCollAmtId.innerText);
                let totUPIColAmt = totUPICollAmtId.innerText.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(totUPICollAmtId.innerText)) :
                    parseInt(totUPICollAmtId.innerText);
                totCashColAmt = ApzCOB.fn_FormatAmount(totCashColAmt - inputEnteredAmt);
                if (custDetails.UPIStatus === "INPROGRESS") {
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).closest('.coll-upiamt').addClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').removeClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).closest('.failedClass').addClass('sno');
                    totUPIColAmt = totUPIColAmt + 0;
                    totCashCollAmtId.innerText = totCashColAmt;
                } else if (custDetails.UPIStatus === "FAILED") {
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).closest('.coll-upiamt').addClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).closest('.failedClass').removeClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).addClass('bg-dark-err');
                    $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').addClass('sno');
                    totUPIColAmt = totUPIColAmt + 0;
                    totCashCollAmtId.innerText = totCashColAmt;
                } else {
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).closest('.coll-upiamt').removeClass('sno');
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).text("₹" + inputEnteredAmt);
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).closest('.failedClass').addClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).removeClass('bg-dark-err');
                    $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').addClass('sno');
                    totUPIColAmt = totUPIColAmt + inputEnteredAmt;
                    totCashCollAmtId.innerText = totCashColAmt;
                }
                totUPICollAmtId.innerText = totUPIColAmt;
            }
            // document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).value = 0;
            // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].cashCollected = 0;
            // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].paymentFlg = "UPI";
            if (!$('#' + grpDataScrId + 'frm_QRDetForm').is(':visible')) {
                $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).closest('.scb-col65').addClass('sno');
                $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).addClass('sno');
            }
        } else {
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].paymentFlg = "CASH";
            apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].upiCollected = 0;
        }
    }
}
// apz.app.GroupsData.onClickReasonChkBx = function(pthis) {
//     let rowNo = pthis.id.split("_").at(-1);
//     apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
//         if (parseInt(rowNo) != i) {
//             $("#" + grpDataScrId + 'resChk_' + i).prop('checked', false);
//             document.getElementById(grpDataScrId + 'resChk_' + i).disabled = false;
//         } else {
//             document.getElementById(grpDataScrId + 'resChk_' + i).disabled = true;
//         }
//         let listDiv = document.querySelector("#" + grpDataScrId + "reasonsList_row_" + i);
//         listDiv.querySelector("#" + grpDataScrId + 'reasonsDiv_row').classList.add('sno');
//         listDiv.querySelector("#" + grpDataScrId + 'row_otherReasonMainRow_row').classList.add('sno');
//     })
//     let listDiv = document.querySelector("#" + grpDataScrId + "reasonsList_row_" + rowNo);
//     if (document.getElementById('KenMet__IPaintPartailPayment__o__IPaintPartialPayReason__reason_' + rowNo).innerText === "Others") {
//         listDiv.querySelector("#" + grpDataScrId + 'reasonsDiv_row').classList.remove('sno');
//     } else {
//         listDiv.querySelector("#" + grpDataScrId + 'reasonsDiv_row').classList.add('sno');
//     }
// }
apz.app.GroupsData.onClickReasonChkBx = function(pthis) {
    let rowNo = pthis.id.split("_").at(-1);
    apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
        let listDiv = document.querySelector("#" + grpDataScrId + "reasonsList_row_" + i);
        if (parseInt(rowNo) !== i) {
            $("#" + grpDataScrId + 'resChk_' + i).prop('checked', false);
            document.getElementById(grpDataScrId + 'resChk_' + i).disabled = false;
            document.getElementById(grpDataScrId + 'reasonsList_row_' + i).classList.remove("active");
            listDiv.querySelector("#KenMet__GroupsData__deathClaim_row").classList.add('sno');
            listDiv.querySelector("#KenMet__GroupsData__reasonsDiv_row").classList.add('sno');
        } else {
            $("#" + grpDataScrId + 'resChk_' + i).prop('checked', true);
            let paintData = apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason[rowNo].reason;

            if (paintData === 'Member Deceased' || paintData === 'Spouse Deceased') {
                listDiv.querySelector("#KenMet__GroupsData__deathClaim_row").classList.remove('sno');
                listDiv.querySelector("#KenMet__GroupsData__reasonsDiv_row").classList.add('sno');
            } else if (paintData === 'Others') {
                listDiv.querySelector("#KenMet__GroupsData__reasonsDiv_row").classList.remove('sno');
                listDiv.querySelector("#KenMet__GroupsData__deathClaim_row").classList.add('sno');
                document.getElementById(grpDataScrId + "inp_otherReasonInp_" + rowNo).value = '';
            } else {
                listDiv.querySelector("#KenMet__GroupsData__deathClaim_row").classList.add('sno');
                listDiv.querySelector("#KenMet__GroupsData__reasonsDiv_row").classList.add('sno');
            }

            document.getElementById(grpDataScrId + 'resChk_' + i).disabled = true;
            document.getElementById(grpDataScrId + 'reasonsList_row_' + i).classList.add("active");
        }
    });
    document.getElementById(grpDataScrId + 'resChk_' + rowNo).disabled = true;
    document.getElementById(grpDataScrId + 'el_btn_34').disabled = true;
    apz.data.scrdata.KenMet__IPaintPartailPayment_Res.IPaintPartialPayReason.forEach((d, i) => {
        if ($("#" + grpDataScrId + 'resChk_' + i).prop('checked')) {
            document.getElementById(grpDataScrId + 'el_btn_34').disabled = false;
        }
    });
};
apz.app.GroupsData.updateCollAmt = function(params) {
    // if (selectedKendra.kendraDet.colldtls.hasOwnProperty('totCollAmt')) {
    //     selectedKendra.kendraDet.colldtls.totCollAmt = selectedKendra.kendraDet.colldtls.totCollAmt + params.totCollAmt;
    //     selectedKendra.kendraDet.colldtls.totalAdv = selectedKendra.kendraDet.colldtls.totalAdv + params.totalAdv;
    //     selectedKendra.kendraDet.colldtls.totalDue = selectedKendra.kendraDet.colldtls.totalDue + params.totalDue;
    //     selectedKendra.kendraDet.colldtls.netDue = selectedKendra.kendraDet.colldtls.netDue + params.netDue;
    // } else {
    // selectedKendra.kendraDet.colldtls.totCollAmt = params.totCollAmt;
    // selectedKendra.kendraDet.colldtls.totalAdv = params.totalAdv;
    // selectedKendra.kendraDet.colldtls.totalDue = params.totalDue;
    // selectedKendra.kendraDet.colldtls.netDue = params.netDue;
    // }
    var [collAmt, dueAmt, netDue, advAmt, grpTotAmt, grpAdvAmt] = Array(6).fill(0);
    selectedKendra.kendraDet.colldtls.groups.forEach((obj, i) => {
        let GroupZeroCol = 0;
        grpTotAmt = 0;
        grpAdvAmt = 0;
        // dueAmt = dueAmt + obj.totalDue;
        // netDue = netDue + obj.netDue;
        // if (obj.hasOwnProperty('totCollAmt') && obj.totCollAmt > 0) {
        //     collAmt = collAmt + obj.totCollAmt;
        //     advAmt = advAmt + obj.totalAdv;
        //     dueAmt = dueAmt + obj.totalDue;
        //     netDue = netDue + obj.netDue;
        // } else {
        let memArr = [];
        if (params.id === obj.id) {
            memArr = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
        } else {
            memArr = obj.members
        }
        // obj.members.forEach((mem, k) => {
        // apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet.forEach((mem, k) => {
        memArr.forEach((mem, k) => {
            if (mem.hasOwnProperty('cashCollected') || mem.hasOwnProperty('upiCollected')) {
                grpAdvAmt = grpAdvAmt + (mem.hasOwnProperty('advAmt') ? parseInt(String(mem.advAmt).replace(/,/g, ''), 10) : 0);
                dueAmt = dueAmt + mem.totalDue;
                netDue = netDue + mem.netDue;
                mem.advAdj = mem.totalAdv > mem.totalDue ? mem.totalDue : mem.totalAdv;
                if (mem.hasOwnProperty('cashCollected') && mem.cashCollected > 0) {
                    grpTotAmt = grpTotAmt + (mem.hasOwnProperty('cashCollected') ? parseInt(String(mem.cashCollected).replace(
                        /,/g, ''), 10) : 0);
                    mem.paymentFlg = "CASH";
                } else if (mem.hasOwnProperty('upiCollected') && mem.upiCollected > 0) {
                    grpTotAmt = grpTotAmt + (mem.hasOwnProperty('upiCollected') ? parseInt(String(mem.upiCollected).replace(/,/g,
                        ''), 10) : 0);
                    mem.paymentFlg = "UPI";
                }
                if ((mem.hasOwnProperty('isZeroParFlg') && mem.isZeroParFlg) || (mem.hasOwnProperty('isZeroCollection') && mem
                        .isZeroCollection)) {
                    GroupZeroCol++;
                }
            }
        })
        if (memArr.length === GroupZeroCol) {
            obj.GrpZeroCol = true;
        } else {
            obj.GrpZeroCol = false;
        }
        collAmt = collAmt + grpTotAmt;
        advAmt = advAmt + grpAdvAmt;
        obj.totCollAmt = grpTotAmt;
        obj.totalAdv = grpAdvAmt;
        // }
    })
    selectedKendra.kendraDet.colldtls.totCollAmt = collAmt
    selectedKendra.kendraDet.colldtls.totalAdv = advAmt;
    selectedKendra.kendraDet.colldtls.totalDue = dueAmt;
    selectedKendra.kendraDet.colldtls.netDue = netDue;
}
// apz.app.GroupsData.validateAmtInput = function(pthis) {
//     let rowno = $(pthis).attr('rowno');
//     let error = false;
//     let dueAmt = apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[rowno].dueAmt;
//     let inputedAmt = document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value;
//     let enteredAmt = $("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val();
//     let advanceAdjAmt = 0;
//     advanceAdjAmt = !apz.isNull(apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv) ? apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv : 0;
//     let totalEnteredAmt = 0;
//     totalEnteredAmt = (parseInt(ApzCOB.fn_unFormatAmount(inputedAmt)) + advanceAdjAmt);
//     // enteredAmt === ("" || undefined) ? 0 : enteredAmt;
//     //modified below change for UAT JIRA issue UNAP-1200 on 11-02-2025
//     if (apz.isNull(enteredAmt) || enteredAmt === "" || enteredAmt === undefined) {
//         enteredAmt = 0;
//     }
//     if (parseInt(enteredAmt) > dueAmt) {
//         $("#" + grpDataScrId + 'amtErrorField_' + rowno).text(ApzCOB.getDescfromLitCode('LIT_COL_MSG_INPUTERRORMSG'));
//         $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).removeClass('sno');
//         error = true;
//     } else {
//         $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).addClass('sno');
//         error = false;
//     }
//     var totaldisbursed = apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.reduce((acc, _, i) => {
//         let disburseAmt = ApzCOB.fn_unFormatAmount($("#" + grpDataScrId + 'inp_disburseAmtVal_' + i).val())
//         return acc + (disburseAmt ? parseInt(disburseAmt) || 0 : 0);
//     }, 0);
//     if (!error) {
//         if (totaldisbursed > totalEnteredAmt) {
//             $("#" + grpDataScrId + 'amtErrorField_' + rowno).text(ApzCOB.getDescfromLitCode('LIT_COL_MSG_SUMERRORMSG') + totalEnteredAmt);
//             $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).removeClass('sno');
//             error = true;
//         } else {
//             $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).addClass('sno');
//             for (i = 0; i < apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.length; i++) {
//                 $("#" + grpDataScrId + 'amtErrorField_' + i).parents().eq(1).addClass('sno');
//             }
//             error = false;
//         }
//     }
//     if (error) {
//         $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', true);
//     } else {
//         $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
//     }
//     let loanCashColl = 0;
//     apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((d, i) => {
//         let lnAmt = document.getElementById(grpDataScrId + "inp_disburseAmtVal_" + i).value;
//         //modified below change for UAT JIRA issue UNAP-1200 on 11-02-2025
//         if (apz.isNull(lnAmt) || lnAmt === "" || lnAmt === undefined) {
//             lnAmt = 0;
//         }
//         loanCashColl = loanCashColl + parseInt(String(lnAmt).replace(/,/g, ''), 10);
//     });
//     apz.setElmValue(grpDataScrId + 'partialPayLoanAmt', '(' + ApzCOB.getDescfromLitCode('LIT_COL_LBL_TOT_ONLY') + ' ₹ ' + +loanCashColl + ' ) ');
// }
apz.app.GroupsData.validateAmtInput = function(pthis) {
    let rowno = $(pthis).attr('rowno');
    let error = false;
    let multipleLoanValidation = [];
    var sum = 0;
    let dueAmt = apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails[rowno].dueAmt;
    let inputedAmt = document.getElementById(grpDataScrId + 'inp_enteredAmtVal').value;
    let enteredAmt = $("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val();
    let advanceAdjAmt = 0;
    advanceAdjAmt = !apz.isNull(apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv) ? apz.data.scrdata
        .KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].totalAdv : 0;
    let totalEnteredAmt = 0;
    totalEnteredAmt = (parseInt(ApzCOB.fn_unFormatAmount(inputedAmt)) + advanceAdjAmt);
    // enteredAmt === ("" || undefined) ? 0 : enteredAmt;
    //modified below change for UAT JIRA issue UNAP-1200 on 11-02-2025
    if (apz.isNull(enteredAmt) || enteredAmt === "" || enteredAmt === undefined) {
        enteredAmt = 0;
    }
    if (parseInt(enteredAmt) > dueAmt) {
        $("#" + grpDataScrId + 'amtErrorField_' + rowno).text(ApzCOB.getDescfromLitCode('LIT_COL_MSG_INPUTERRORMSG'));
        $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).removeClass('sno');
        error = true;
    } else {
        $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).addClass('sno');
        error = false;
    }
    var totaldisbursed = apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.reduce((acc, _, i) => {
        let disburseAmt = $("#" + grpDataScrId + "inp_disburseAmtVal_" + i).val().replace(/,/g, '');
        return acc + (disburseAmt ? parseInt(disburseAmt) || 0 : 0);
    }, 0);
    if (!error) {
        if (totaldisbursed > totalEnteredAmt) {
            $("#" + grpDataScrId + 'amtErrorField_' + rowno).text(ApzCOB.getDescfromLitCode('LIT_COL_MSG_SUMERRORMSG') + totalEnteredAmt);
            $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).removeClass('sno');
            error = true;
        } else {
            $("#" + grpDataScrId + 'amtErrorField_' + rowno).parents().eq(1).addClass('sno');
            for (i = 0; i < apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.length; i++) {
                $("#" + grpDataScrId + 'amtErrorField_' + i).parents().eq(1).addClass('sno');
            }
            error = false;
        }
    }
    if (error) {
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', true);
    } else {
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
    }
    if (apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.length > 1) {
        apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((loan, i) => {
            sum += parseInt($("#" + grpDataScrId + 'inp_disburseAmtVal_' + i).val().replace(/,/g, ''));
            let inp = $("#" + grpDataScrId + 'inp_disburseAmtVal_' + i).val();
            let obj = {
                "loan": ""
            }
            if (parseInt(inp.replace(/,/g, '')) > loan.dueAmt) {
                obj.loan = i
                multipleLoanValidation.push(obj);
                $("#" + grpDataScrId + 'amtErrorField_' + i).text(ApzCOB.getDescfromLitCode('LIT_COL_MSG_INPUTERRORMSG'));
                $("#" + grpDataScrId + 'amtErrorField_' + i).parents().eq(1).removeClass('sno');
                // $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', true);
            } else {
                multipleLoanValidation = multipleLoanValidation.filter(function(obj) {
                    return obj.loan !== i;
                });
                $("#" + grpDataScrId + 'amtErrorField_' + i).parents().eq(1).addClass('sno');
                // $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
            }
        })
    }
    if (sum > totalEnteredAmt && error) {
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', true);
    } else if (!error) {
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
    }
    if (multipleLoanValidation.length > 0) {
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', true);
    }
    let loanCashColl = 0;
    apz.data.scrdata.KenMet__IPaintGroupData_Res.LoanDetails.forEach((d, i) => {
        let lnAmt = document.getElementById(grpDataScrId + "inp_disburseAmtVal_" + i).value;
        //modified below change for UAT JIRA issue UNAP-1200 on 11-02-2025
        if (apz.isNull(lnAmt) || lnAmt === "" || lnAmt === undefined) {
            lnAmt = 0;
        }
        loanCashColl = loanCashColl + parseInt(String(lnAmt).replace(/,/g, ''), 10);
    });
    apz.setElmValue(grpDataScrId + 'partialPayLoanAmt', '(' + ApzCOB.getDescfromLitCode('LIT_COL_LBL_TOT_ONLY') + ' ₹ ' + +loanCashColl + ' ) ');
}
apz.app.GroupsData.fnValidateAmtDecSpcl = function(pthis){
    pthis.value = pthis.value.replace(/[^0-9]/g, '');
}
// apz.app.GroupsData.validateOnfocus = function(pthis) {
//     var rowno = $(pthis).attr('rowno');
//     if ($("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val() === '0') {
//         $("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val('');
//     }else{
//         var x = $("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val();
//         x = x.replaceAll(",", "");
//         $("#" + grpDataScrId + 'inp_disburseAmtVal_' + rowno).val(x);
//     }
// }
apz.app.GroupsData.onClickOfCustomerDetails = function(pthis) {
    let backNavData = {};
    backNavData.childScrId = 'KenMet'
    backNavData.scr = 'GroupsData';
    backNavData.screenId = grpDataScrId;
    backNavData.baseDiv = 'groupDataBaseDiv';
    backNavData.data = JSON.parse(JSON.stringify(backNavPaintRecData));
    let selRow = pthis.id.split("_").at(-1);
    backNavData.selCustId = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selRow].id;
    backNavData.customerDet = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selRow];
    viewCustomerFlagGroupsData = true;
    ApzCOB.customerDetNavigationFunc(backNavData);
    /* for (let i = 0; i < KendraApp.KendraResponse.length; i++) {
         if (KendraApp.KendraResponse[i].kendraDtls.customerDtls) {
             for (let j = 0; j < KendraApp.KendraResponse[i].kendraDtls.customerDtls.length; j++) {
                 let kendraCustData = KendraApp.KendraResponse[i].kendraDtls.customerDtls[j];
                 if (kendraCustData.customerId == selCustId) {
                     data = kendraCustData;
                 }
             }
         }
     }
     KendraApp.selectedCustomer = data;
     ApzCOB.launchMicroApp('Custom', 'CustomerDetails', grpDataScrId + 'groupDataBaseDiv', backNavData);
     document.getElementById(grpDataScrId + "row_groupsHeader").classList.add('sno');
     document.getElementById(grpDataScrId + "row_gorupsDataRow").classList.add('sno');
     document.getElementById(grpDataScrId + "groupDataDiv").classList.add('sno');
     document.getElementById(grpDataScrId + "row_footerDiv").classList.add('sno');
     $("#" + kmDashScrId + 'calculatorIcon').addClass('sno');*/
}
apz.app.GroupsData.hideKeyboard = function(inputElement) {
    inputElement.readOnly = true;
    setTimeout(() => {
        inputElement.readOnly = false;
        inputElement.focus();
    }, 200);
}
apz.app.GroupsData.formatEnteredAmount = function(inputElement) {
    setTimeout(() => {
        if (!keypadClicked) {
            const rawValue = parseFloat(inputElement.value.replace(/,/g, '') || 0);
            // Format the value in Indian Rupee format without decimals
            inputElement.value = rawValue.toLocaleString('en-IN', {
                // style: 'currency',
                // currency: 'INR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            })
        }
        keypadClicked = false; // Reset the flag after formatting
    }, 200);
}
apz.app.GroupsData.unFormatEnteredAmount = function(inputElement) {
    inputElement.value = inputElement.value.replace(/[^0-9]/g, '');
    // setTimeout(() => {
    //     inputElement.blur();  // Ensure it remains unfocused
    // }, 0);
}
//function to hide mobile keypad on switch of app.
document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") {
        // App or tab has become active again
        const inputField = document.getElementById("KenMet__GroupsData__inp_enteredAmtVal");
        // Check if the input field is focused
        if (document.activeElement === inputField) {
            // Blur the input field to hide the mobile keypad
            inputField.blur();
        }
    }
});
apz.app.GroupsData.preventKeypad = function(event) {
    // Prevent the default focus behavior to avoid triggering the keypad
    event.preventDefault();
    // Refocus the input programmatically to show the cursor without opening the keypad
    const inputField = event.target;
    inputField.focus({
        preventScroll: true
    });
}
apz.app.GroupsData.onCancelAdvanceModal = function() {
    if (document.body.classList.contains("mdl-opn")) {
        document.body.classList.remove("mdl-opn");
    }
    ApzCOB.toggleModal(grpDataScrId + 'mdl_amtEntryModal');
    ApzCOB.toggleModal(grpDataScrId + 'mdl_coll_advAmtModal');
    let inputField = document.getElementById(grpDataScrId + 'inp_enteredAmtVal');
    setTimeout(() => {
        inputField.focus();
        apz.app.GroupsData.hideKeyboard(inputField);
        if (!$('body').hasClass('modal-open')) {
            $('body').addClass('modal-open')
        }
    }, 200)
    document.getElementById(grpDataScrId + 'inp_enteredAmtVal').disabled = false;
    document.getElementById(grpDataScrId + 'row_qrRelatedDiv').classList.add('sno');
    document.getElementById(grpDataScrId + 'amtKeyPad').classList.remove('sno');
    document.getElementById(grpDataScrId + 'nav_submitBtn').classList.add('sno');
}
apz.app.GroupsData.onBackNavYes = function() {
    isMarkCollectionEdition = false;
    kendraDetails.kendraDet.colldtls.groups[selectedKendraRow].members = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
    selectedKendra = kendraDetails;
    grpBackNavData = JSON.parse(JSON.stringify(selectedKendra));
    ApzCOB.toggleModal(grpDataScrId + 'mdl_backNavModal');
    if ($('body').hasClass('modal-open')) {
        $('body').removeClass('modal-open')
    }
    apz.app.KMDashboard.handleBackFunction('fromGroupData');
}
apz.app.GroupsData.generateVPALink = function() {}
apz.app.GroupsData.onBackNavNo = function() {
    // var launchObj = [];
    // launchObj = grpBackNavData;
    deathIntGrpObj[selectedGrpId] = [];
    ApzCOB.toggleModal(grpDataScrId + 'mdl_backNavModal');
    // ApzCOB.launchMicroApp("KenMet", "KMDashboard", "APZCBO__BaseScreens__BaseDIV", launchObj);
    isMarkCollectionEdition = false;
    apz.app.KMDashboard.handleBackFunction('fromGroupData');
}
apz.app.GroupsData.fetchCustomerListOfDeathIntDraftRec = function() {
    if (!Array.isArray(window.deathIntimationData) || window.deathIntimationData.length === 0) {
        return [];
    }
    let customerList = [];
    window.deathIntimationData.forEach((d) => {
        d.PAYLOAD.paylod.forEach((rec) => {
            customerList.push(rec.id);
        });
    });
    return customerList;
}
apz.app.GroupsData.generateQr = function() {
    // var lscanObj = {};
    // lscanObj.accNo = params.accountNo;
    // lscanObj.mobileNo = gApzCOB.LoggedInUserDetails.loginResponse.phone1;
    // lscanObj.txnType = "";
    // lscanObj.ccy = "INR";
    // lscanObj.accType = "";
    // lscanObj.accName = "";
    // lscanObj.customerId = apz.userId;
    // lscanObj.bankName = "Appzillon Bank";
    // lscanObj.amt = "";
    // apz.app.GroupsData.generateBarCode(lscanObj);
    let params = {};
    let data = {};
    let remarkType = isPartialCollection ? "partial" : "Full";
    data = {
        "applicationId": "",
        "customerId": selectedCustomerDetails.id,
        //commented below and modified by sathish on 14-02-2025
        //for showing entered amount instead of collection amount
        // "amount": (selectedCustomerDetails.collAmount).toString() + ".0",
        "amount": (inputEnteredAmt).toString() + ".0",
        "billNumber": selectedCustomerDetails.id + selectedKendra.kendraDet.colldtls.collId, // CustomerId + CollectionId
        "remarks": apz.app.GroupsData.returnCustRemarks(
        remarkType), // Either of the possible values to be provided [Standard-Full, Standard-Partial, Repeat-Full, Repeat-Partial, Advance]
        "mobileNumber": "", // Customer Mobile Number
        "customerName": selectedCustomerDetails.name //Customer name
    }
    CollectionsCommon.getQRCodeCall(data);
    // apz.app.GroupsData.callQRGenFn();
}
/*apz.app.GroupsData.generateBarCode = function(lval) {
    var targetWidth, targetHeight;
    if (apz.deviceOs === "iOS") {
        targetWidth = "400"
        targetHeight = "300"
    } else {
        targetWidth = "456"
        targetHeight = "456"
    }
    var json = {
        "inputString": lval,
        "base64": "Y",
        "targetWidth": targetWidth,
        "targetHeight": targetHeight,
        "destinationPath": "docs",
        "fileName": "QRCode"
    };
    json.id = "BARCODE_GEN";
    json.callBack = apz.app.GroupsData.barcodeGenCB;
    apz.ns.genBarcode(json);
}
apz.app.GroupsData.barcodeGenCB = function(params) {
    genBarcode = params.text;
    document.querySelector('.modal-header h1').textContent = "Show QR To Member"
    $('#' + grpDataScrId + "frm_qrImageForm").removeClass("sno");
    $('#' + grpDataScrId + 'gensuccqr').attr('src', "data:image/jpg;base64," + params.text);
    let customerName = document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__customerName_' + selCustRowNo).innerText;
    document.getElementById(grpDataScrId + 'txt_selecCustName').innerText = 'For ' + customerName + " (₹" + ApzCOB.fn_FormatAmount(
        inputEnteredAmt);
}*/
apz.app.GroupsData.postFetchQR = function(params) {
    let base64Val = "";
    try {
        if (params.status) {
            window.isQRSuccess = true;
            base64Val = params.data.intentBase64;
            $('#' + grpDataScrId + 'gensuccqr').attr('src', "data:image/jpg;base64," + base64Val);
            document.querySelector('.modal-header h1').textContent = "Show QR To Member"
            // $('#' + grpDataScrId + "frm_qrImageForm").removeClass("sno");
            // $('#' + grpDataScrId + "frm_QRDetForm").addClass('sno');
            // $('#' + grpDataScrId + "row_custEditAmtMainRow").addClass('sno');
            // $('#' + grpDataScrId + "nav_col_custNameTimer").removeClass("sno");
            // $("#" + grpDataScrId + "row_col_Regenerateotp").addClass("sno");
            // //   $("#" + screenID + "Regenerateotp_ul").removeClass("sno");
            // $("#" + grpDataScrId + "row_scanQrCodeLabelRow").removeClass("sno");
            // $("#" + grpDataScrId + "row_QRImageMainRow").removeClass("sno");
            $("#" + grpDataScrId + "col_row_expiryDIV").addClass("sno");
            // $("#" + grpDataScrId + "AmountAgainstLoanDiv").addClass("sno");
            // document.getElementById(grpDataScrId + 'row_custEditAmtMainRow').classList.add('sno');
            let customerName = document.getElementById('KenMet__IPaintKendMeetings__o__GroupsCustomerDet__customerName_' + selCustRowNo)
            .innerText;
            document.getElementById(grpDataScrId + 'row_customerNameQR').classList.remove('sno');
            document.getElementById(grpDataScrId + 'txt_QRCustomerName').innerText = 'For ' + customerName + " (₹" + ApzCOB.fn_FormatAmount(
                inputEnteredAmt) + ")";
            var counter;
            counter = new TimerCounter();
            counter.init("" + "KenMet__GroupsData__otptimertext", QRTimerSetVal);
            QRStatusTimerInterval = setInterval(() => {
                apz.app.GroupsData.CheckQRPaymentStatus();
            }, QRRefreshTimer)
        }
    } catch (e) {}
}
apz.app.GroupsData.loadQRImageAndDet = function() {
    $('#' + grpDataScrId + "frm_qrImageForm").removeClass("sno");
    $('#' + grpDataScrId + "frm_QRDetForm").addClass('sno');
    $('#' + grpDataScrId + "row_custEditAmtMainRow").addClass('sno');
    $('#' + grpDataScrId + "nav_col_custNameTimer").removeClass("sno");
    $("#" + grpDataScrId + "row_col_Regenerateotp").addClass("sno");
    //   $("#" + screenID + "Regenerateotp_ul").removeClass("sno");
    $("#" + grpDataScrId + "row_scanQrCodeLabelRow").removeClass("sno");
    $("#" + grpDataScrId + "row_QRImageMainRow").removeClass("sno");
    $("#" + grpDataScrId + "AmountAgainstLoanDiv").addClass("sno");
    document.getElementById(grpDataScrId + 'row_custEditAmtMainRow').classList.add('sno');
}
apz.app.GroupsData.CheckQRPaymentStatus = function() {
    var obj = {
        "customerId": selectedCustomerDetails.id,
        "billNumber": selectedCustomerDetails.id + selectedKendra.kendraDet.colldtls.collId,
    }
    CollectionsCommon.getQRPaymentStatus(obj);
}
apz.app.GroupsData.returnCustRemarks = function(type) {
    let remark = "";
    switch (type) {
        case "partial":
            remark = "Standard-Partial";
        case "Full":
            remark = "Standard-Full";
        case "repeatPartial":
            remark = "Repeat-Partial";
        case "repeatFull":
            remark = "Repeat-Full";
        default:
            remark = "Standard-Full";
    }
    return remark;
}
apz.app.GroupsData.timerEnd = function() {
    if (apz.childScr === 'GroupsData') {
        //   if (window.otpRegenCount !== RegenCount) {
        $("#" + grpDataScrId + "row_col_Regenerateotp").removeClass("sno");
        document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 0.1;
        $("#" + grpDataScrId + "col_row_expiryDIV").addClass("sno");
        $("#" + grpDataScrId + "row_scanQrCodeLabelRow").addClass('sno');
        if (isAmtOrQRText === "QR") {
            clearInterval(QRStatusTimerInterval);
        }
        // $("#" + grpDataScrId + "nav_col_custNameTimer").addClass("sno");
        // $("#" + grpDataScrId + "row_scanQrCodeLabelRow").addClass("sno");
        // $("#" + grpDataScrId + "row_QRImageMainRow").addClass("sno");
        //   } else if (!ShowError) {
        //       window.ShowError = true;
        //      // ApzRMB.fnDisplayMsg(ApzRMB.getDescfromLitCode("LIT_OTP_REGEN_ERROR"), 'E', ApzRMB.launchDashboard);
        //      if(postLoginScrn === 'PostLogin') {
        //         ApzRMB.fnDisplayMsg(ApzRMB.getDescfromLitCode("LIT_OTP_REGEN_ERROR"), 'E', ApzRMB.launchDashboard); 
        //      }
        //      else {
        //          ApzRMB.fnDisplayMsg(ApzRMB.getDescfromLitCode("LIT_OTP_REGEN_ERROR"), 'E', apz.app.PreLogin_BaseScreen.launchpreloginbasescreenforOTP);
        //      }
        //   }
    }
}
apz.app.GroupsData.regenerateQR = function() {
    apz.app.GroupsData.generateQr();
    document.getElementById(grpDataScrId + 'row_col_Regenerateotp').classList.add('sno');
    $("#" + grpDataScrId + "nav_col_custNameTimer").removeClass("sno");
    $("#" + grpDataScrId + "row_scanQrCodeLabelRow").removeClass("sno");
    $("#" + grpDataScrId + "row_QRImageMainRow").removeClass("sno");
    document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 1;
}
apz.app.GroupsData.postQRPaySuc = function(params) {
    if (params.status === "SUCCESS") {
        document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 0.1;
        clearInterval(QRStatusTimerInterval);
        clearInterval(selInterval);
        $("#" + grpDataScrId + "row_scanQrCodeLabelRow").addClass("sno");
        $("#" + grpDataScrId + "col_row_expiryDIV").addClass("sno");
        $("#" + grpDataScrId + "row_succQRTickIcon").removeClass('sno');
        $("#" + grpDataScrId + "txt_postQRAmtTxt").text("₹" + ApzCOB.fn_FormatAmount(inputEnteredAmt) + " Collection Successful");
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
        $("#" + grpDataScrId + "mdl_amtEntryModal_close").addClass('sno');
        $("#" + grpDataScrId + "row_col_refIdRow").removeClass('sno');
        $("#" + grpDataScrId + "txt_col_refId").text('Ref id: #' + params.txnId)
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "SUCCESS";
        apz.app.GroupsData.removeCustUPIRetry(selectedCustomerDetails.id);
    } else if (params.status === "INITIATED") {} else if (params.status === "INPROGRESS") {
        clearInterval(QRStatusTimerInterval);
        clearInterval(selInterval);
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "INPROGRESS";
        $("#" + grpDataScrId + "btn_submitBtnId").click();
        $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').removeClass('sno');
    } else if (params.status === "FAIL") {
        clearInterval(QRStatusTimerInterval);
        clearInterval(selInterval);
        // $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).parent().parent().removeClass('sno');
        // $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).addClass('bg-dark-err');
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "FAILED";
        $("#" + grpDataScrId + "row_col_paymentFailedRow").removeClass('sno');
        $("#" + grpDataScrId + "btn_upiRetryBtn_" + selCustRowNo).attr('disabled', false);
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
        apz.app.GroupsData.insertCustUPIRetry(selectedCustomerDetails);
        document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 0.1;
        $('#' + grpDataScrId + 'col_row_expiryDIV').addClass('sno');
        $('#' + grpDataScrId + 'row_scanQrCodeLabelRow').addClass('sno');
    }
}
apz.app.GroupsData.insertCustUPIRetry = function(custDetails) {
    if (retryUPIArray.length > 0) {
        const exists = retryUPIArray.some(item => item.id === custDetails.id);
        if (!exists) {
            retryUPIArray.push(newItem);
        }
    }
}
apz.app.GroupsData.removeCustUPIRetry = function(id) {
    if (retryUPIArray.length > 0) {
        const index = retryUPIArray.findIndex(item => item.id === id);
        if (index !== -1) {
            const removedItem = retryUPIArray.splice(index, 1); // Remove the item
        }
    }
}
apz.app.GroupsData.compareSpecificFields = function(array1, array2) {
    let noChange = true;
    for (let i = 0; i < array1.length; i++) {
        const item1 = array1[i];
        const item2 = array2[i];
        if (item1.hasOwnProperty('upiCollected') && item2.hasOwnProperty('upiCollected')) {
            if (item1.upiCollected !== item2.upiCollected) {
                noChange = false; // or handle differently if you don't want to return early
            }
        } else if (item1.hasOwnProperty('upiCollected') && !item2.hasOwnProperty('upiCollected')) {
            noChange = false
        }
        if (item1.hasOwnProperty('cashCollected') && item2.hasOwnProperty('cashCollected')) {
            if (item1.cashCollected !== item2.cashCollected) {
                noChange = false; // or handle differently if you don't want to return early
            }
        } else if (item1.hasOwnProperty('cashCollected') && !item2.hasOwnProperty('cashCollected')) {
            noChange = false
        }
    }
    return noChange;
}
apz.app.GroupsData.retryUPIPayment = function(pthis) {
    selCustRowNo = $(pthis).attr('rowno');
    let collAmount = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].collAmount
    $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).attr('data-disabled', false);
    $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).val(collAmount)
    $('#' + grpDataScrId + 'qrScanIcon_' + selCustRowNo).click();
}
apz.app.GroupsData.checkProgressOfUPIPayment = function(pthis) {
    selCustRowNo = $(pthis).attr('rowno');
    selectedCustDetails = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo];
    isFromInProgress = true;
    var obj = {
        "customerId": selectedCustDetails.id,
        "billNumber": selectedCustDetails.id + selectedKendra.kendraDet.colldtls.collId,
    }
    CollectionsCommon.getQRPaymentStatus(obj);
}
apz.app.GroupsData.updateInProgressUPI = function(params) {
    isFromInProgress = false;
    if (params.status === "SUCCESS") {
        document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 0.1;
        $("#" + grpDataScrId + "row_scanQrCodeLabelRow").addClass("sno");
        $("#" + grpDataScrId + "col_row_expiryDIV").addClass("sno");
        $("#" + grpDataScrId + "row_succQRTickIcon").removeClass('sno');
        $("#" + grpDataScrId + "txt_postQRAmtTxt").text("₹" + ApzCOB.fn_FormatAmount(inputEnteredAmt) + "Collection Successful");
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
        $("#" + grpDataScrId + "mdl_amtEntryModal_close").addClass('sno');
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "SUCCESS";
        let upiCollectedAmt = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].upiCollected;
        $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').addClass('sno');
        $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).closest('.coll-upiamt').removeClass('sno');
        $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + selCustRowNo).text(upiCollectedAmt);
    } else if (params.status === "INITIATED") {} else if (params.status === "INPROGRESS") {
        $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + selCustRowNo).closest('.coll-upiamt').removeClass('sno');
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "INPROGRESS";
    } else if (params.status === "FAIL") {
        $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).closest('.failedClass').removeClass('sno');
        $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + selCustRowNo).addClass('bg-dark-err');
        apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selCustRowNo].UPIStatus = "FAILED";
        $("#" + grpDataScrId + "col_row_expiryDIV").addClass("sno");
        $("#" + grpDataScrId + "row_col_paymentFailedRow").removeClass('sno');
        $("#" + grpDataScrId + "btn_upiRetryBtn_" + selCustRowNo).attr('disabled', false);
        $("#" + grpDataScrId + "btn_submitBtnId").attr('disabled', false);
        document.getElementById(grpDataScrId + 'gensuccqr').style.opacity = 0.1;
    }
}
apz.app.GroupsData.collectInCashFn = function() {
    ApzCOB.toggleModal(grpDataScrId + 'mdl_UPINotAllowedBranch');
    $('#KenMet__IPaintKendMeetings__o__GroupsCustomerDet__cashCollected_' + selCustRowNo).click();
}
// apz.app.GroupsData.onBlurLoanAmount = function(pthis) {
//     var x = $('#' + pthis.id).val();
//     if (apz.isNull(x) || x === 0 || x === "" || x === "0") {
//         $('#' + pthis.id).val(0)
//     } else {
//         ApzCOB.formatamount(pthis);
//     }
// }
apz.app.GroupsData.onAmtEntryModalClose = function() {
    if ($('#KenMet__GroupsData__frm_qrImageForm').is(':visible')) {
        clearInterval(QRStatusTimerInterval);
        clearInterval(selInterval);
    }
}
apz.app.GroupsData.onClickRefreshAll = function() {
    if (!$('#' + grpDataScrId + 'noRecDiv').is(':visible')) {
        let customerDet = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
        let QRInitiatedCustArr = customerDet.filter(cust => {
            return cust.hasOwnProperty('paymentFlg') && cust.paymentFlg === "UPI" && cust.UPIStatus === "INPROGRESS";
        })
        if (QRInitiatedCustArr.length > 0) {
            let custIds = QRInitiatedCustArr.map(customer => customer.id).join('~');
            CollectionsCommon.fetchUPIStatusForAll(custIds)
        }
    }
}
apz.app.GroupsData.paintUPIRefreshAllStatus = function(respObj) {
    let customerDet = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet;
    let totUPICollAmtId = document.getElementById(grpDataScrId + 'txt_UPICollection');
    let totUPIColAmt = totUPICollAmtId.innerText.includes(',') ? parseInt(ApzCOB.fn_unFormatAmount(totUPICollAmtId.innerText)) : parseInt(
        totUPICollAmtId.innerText);
    respObj.forEach((res, i) => {
        customerDet.forEach((obj, j) => {
            if (res.customerId === obj.id) {
                if (res.status === "SUCCESS") {
                    apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[j].UPIStatus = "SUCCESS";
                    let upiCollectedAmt = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[j].collAmount;
                    $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + j).closest('.coll-upiamt').addClass('sno');
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + j).closest('.coll-upiamt').removeClass('sno');
                    $('#' + grpDataScrId + 'txt_QRAmtPostAdd_' + j).text(upiCollectedAmt);
                    totUPIColAmt = totUPIColAmt + apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[j].collAmount;
                } else if (res.status === "INITIATED") {} else if (res.status === "INPROGRESS") {
                    $('#' + grpDataScrId + 'txt_UPIInProgressErrTxt_' + j).closest('.coll-upiamt').removeClass('sno');
                    apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[j].UPIStatus = "INPROGRESS";
                } else if (res.status === "FAIL") {
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + j).closest('.failedClass').removeClass('sno');
                    $('#' + grpDataScrId + 'txt_UPIFailedErrTxt_' + j).addClass('bg-dark-err');
                    apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[j].UPIStatus = "FAILED";
                    $("#" + grpDataScrId + "btn_upiRetryBtn_" + j).attr('disabled', false);
                }
            }
        })
    })
    totUPICollAmtId.innerText = ApzCOB.fn_FormatAmount(totUPIColAmt);
    apz.stopLoader();
}
apz.app.GroupsData.loadPendUpdateDetails = function(pthis) {
    let selRowNo = $(pthis).attr('rowno');
    let selCustDet = apz.data.scrdata.KenMet__IPaintKendMeetings_Res.GroupsCustomerDet[selRowNo];
    let mobileNumb = (selCustDet.mobileNumber !== undefined && selCustDet.mobileNumber !== "") ? "Mobile No. not verified (" + selCustDet
        .mobileNumber + ")" : "Mobile No. not updated";
    let kendraDts = kendraResponse.find((d) => d.kendraDtls.kendraId == selectedKendra.kendraId);
    let customerDts = kendraDts.kendraDtls.customerDtls.find((cut) = cust => cust.customerId == selCustDet.id);
    setTimeout(() => {
        $("#" + grpDataScrId + "txt_mobileNumUpdate").text(mobileNumb);
        document.getElementById(grpDataScrId + 'mobNoErrDiv').classList.add("sno");
        document.getElementById(grpDataScrId + 'kycErrDiv').classList.add("sno");
        document.getElementById(grpDataScrId + 'txt_spousekyc_dts').classList.add("sno");
        document.getElementById(grpDataScrId + 'txt_acc_dts').classList.add("sno");
        if (selCustDet.mobileNumber === undefined || selCustDet.mobileNumber === "") {
            document.getElementById(grpDataScrId + 'mobNoErrDiv').classList.remove("sno");
        }
        if (selCustDet.primaryId === "" || selCustDet.primaryId === undefined) {
            document.getElementById(grpDataScrId + 'kycErrDiv').classList.remove("sno");
        }
        if (customerDts.bankAccNo === "" || customerDts.bankAccNo === undefined) {
            document.getElementById(grpDataScrId + 'txt_acc_dts').classList.remove("sno");
        }
        if (customerDts.maritalStatus === "MARRIED" && apz.isNull(customerDts.depDocId)) {
            document.getElementById(grpDataScrId + 'txt_spousekyc_dts').classList.remove("sno");
        }
    }, 500);
}
apz.app.GroupsData.onClickPopoverClose = function() {
    $("#" + grpDataScrId + "txt_groupName").click();
}
apz.app.GroupsData.hideAndShowIButton = function(kendraId, customerId) {
    let kendraDts = kendraResponse.find((d) => d.kendraDtls.kendraId == kendraId);
    if (!apz.isNull(kendraDts.kendraDtls.customerDtls)) {
        let customerDts = kendraDts.kendraDtls.customerDtls.find((cut) = cust => cust.customerId == customerId);
        if ((customerDts.hasOwnProperty("mobileNum") && apz.isNull(customerDts.mobileNum) && customerDts.mobileNum === "")) {
            return false;
        } else if ((customerDts.hasOwnProperty("primaryId") && apz.isNull(customerDts.primaryId) && customerDts.primaryId === "")) {
            return false;
        } else if ((customerDts.hasOwnProperty("bankAccNo") && apz.isNull(customerDts.bankAccNo) && customerDts.bankAccNo === "")) {
            return false;
        } else if ((customerDts.hasOwnProperty("maritalStatus") && apz.isNull(customerDts.maritalStatus) && customerDts.maritalStatus ===
                "MARRIED" && apz.isNull(customerDts.depDocId))) {
            return false;
        }
    }
    return true;
}
apz.app.GroupsData.reasonsCB = function() {
    $("#KenMet__KMDashboard__calculatorIcon").removeClass('sno');
    ApzCOB.toggleModal(grpDataScrId + 'partialModel');
    let modal1 = document.getElementById(grpDataScrId + 'partialModel');
    ApzCOB.toggleModal('KenMet__GroupsData__customAlertModel');
    let btn = document.getElementById("KenMet__GroupsData__el_btn_34");
    btn.disabled = false;
}
apz.app.GroupsData.isClaimFormEntered = function(value, row) {
    if (value === 'Member Deceased' || value === 'Spouse Deceased') {
        if (apz.isNull(apz.getElmValue(grpDataScrId + 'fam_mem_name_' + row)) || apz.isNull(apz.getElmValue(grpDataScrId + 'fam_mem_mob_' +
            row))) {
            return true;
        } else {
            return false;
        }
    }
}
apz.app.GroupsData.checkValideMobileNo = function(value, row) {
    if (value === 'Member Deceased' || value === 'Spouse Deceased') {
        let mobNo = (apz.getElmValue(grpDataScrId + 'fam_mem_mob_' + row))
        let mobLength = mobNo.length;
        if (mobLength !== 10) {
            return true;
        } else {
            return false;
        }
    }
}
apz.app.GroupsData.validPhoneNumber = function(pthis) {
    var ALLOWONLYNUMDECIMALS = /[^0-9 .]/g
    pthis.value = pthis.value.replace(ALLOWONLYNUMDECIMALS, '');
    if (pthis.value.includes('.')) {
        let [integerPart, decimalPart] = pthis.value.split('.');
        pthis.value = `${integerPart}.${decimalPart.substring(0, 2)}`;
    }
    if (pthis.value && pthis.value.length >= 1) {
        let firstDigit = pthis.value[0];
        if (['9', '8', '7', '6'].includes(firstDigit)) {
            return;
        } else {
            //ApzCOB.fnDisplayMsg(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_VALID_PHONE_NO"), "E");
            ApzCOB.toggleModal(grpDataScrId + 'customAlertModel');
            $("#KenMet__GroupsData__el_txt_161_txtcnt").text(ApzCOB.getDescfromLitCode("LIT_COLL_MSG_VALID_PHONE_NUM"))
            $("#KenMet__KMDashboard__calculatorIcon").addClass('sno');
            ApzCOB.toggleModal(grpDataScrId + 'partialModel');
            if (!$('body').hasClass('mdl-opn')) {
                $('body').addClass('mdl-opn')
            }
            apz.setElmValue(pthis.id, '');
        }
    }
}
apz.app.GroupsData.settingFieldLength = function(pthis, val) {
    apz.setElmValue(pthis.id, $('#' + pthis.id).val().substr(0, val))
}
